import*as e from"three";import{TrianglesDrawMode as t,TriangleFanDrawMode as r,TriangleStripDrawMode as n,Loader as o,LoaderUtils as s,FileLoader as a,MeshPhysicalMaterial as i,Vector2 as l,Color as c,LinearSRGBColorSpace as u,SRGBColorSpace as h,SpotLight as d,PointLight as f,DirectionalLight as p,Matrix4 as g,Vector3 as m,Quaternion as v,InstancedMesh as y,InstancedBufferAttribute as x,Object3D as b,TextureLoader as S,ImageBitmapLoader as T,BufferAttribute as w,InterleavedBuffer as A,InterleavedBufferAttribute as _,LinearMipmapLinearFilter as R,NearestMipmapLinearFilter as U,LinearMipmapNearestFilter as C,NearestMipmapNearestFilter as k,LinearFilter as E,NearestFilter as I,RepeatWrapping as L,MirroredRepeatWrapping as M,ClampToEdgeWrapping as F,PointsMaterial as D,Material as P,LineBasicMaterial as O,MeshStandardMaterial as G,DoubleSide as B,MeshBasicMaterial as N,PropertyBinding as H,BufferGeometry as j,SkinnedMesh as z,Mesh as W,LineSegments as V,Line as X,LineLoop as q,Points as $,Group as K,PerspectiveCamera as Y,MathUtils as Q,OrthographicCamera as Z,Skeleton as J,AnimationClip as ee,Bone as te,InterpolateDiscrete as re,InterpolateLinear as ne,Texture as oe,VectorKeyframeTrack as se,NumberKeyframeTrack as ae,QuaternionKeyframeTrack as ie,ColorManagement as le,FrontSide as ce,Interpolant as ue,Box3 as he,Sphere as de,SphereGeometry as fe,DataTextureLoader as pe,HalfFloatType as ge,FloatType as me,DataUtils as ve,MeshDistanceMaterial as ye,MeshDepthMaterial as xe,RGBADepthPacking as be,UniformsUtils as Se,ShaderChunk as Te,InstancedBufferGeometry as we,Matrix3 as Ae,Vector4 as _e,PlaneGeometry as Re}from"three";import{Types as Ue,Component as Ce,System as ke,World as Ee}from"ecsy";class Ie{static createButton(e,t={}){const r=document.createElement("button");function n(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null}function o(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="VRButton",r.style.display="none",o(r),navigator.xr.isSessionSupported("immersive-vr").then(function(o){o?function(){let n=null;async function o(t){t.addEventListener("end",s),await e.xr.setSession(t),r.textContent="EXIT VR",n=t}function s(){n.removeEventListener("end",s),r.textContent="ENTER VR",n=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR";const a={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){null===n?navigator.xr.requestSession("immersive-vr",a).then(o):(n.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",a).then(o).catch(e=>{console.warn(e)}))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",a).then(o).catch(e=>{console.warn(e)})}():(n(),r.textContent="VR NOT SUPPORTED"),o&&Ie.xrSessionIsGranted&&r.click()}).catch(function(e){n(),console.warn("Exception when trying to call xr.isSessionSupported",e),r.textContent="VR NOT ALLOWED"}),r;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",o(e),e}}static registerSessionGrantedListener(){if("undefined"!=typeof navigator&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{Ie.xrSessionIsGranted=!0})}}}Ie.xrSessionIsGranted=!1,Ie.registerSessionGrantedListener();const Le=["local-floor","bounded-floor","hand-tracking","layers","dom-overlay"];function Me(e,o){if(o===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(o===r||o===n){let t=e.getIndex();if(null===t){const r=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)r.push(e);e.setIndex(r),t=e.getIndex()}const n=t.count-2,s=[];if(o===r)for(let e=1;e<=n;e++)s.push(t.getX(0)),s.push(t.getX(e)),s.push(t.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(s.push(t.getX(e)),s.push(t.getX(e+1)),s.push(t.getX(e+2))):(s.push(t.getX(e+2)),s.push(t.getX(e+1)),s.push(t.getX(e)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(s),a.clearGroups(),a}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",o),e}class Fe extends o{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Ne(e)}),this.register(function(e){return new Ke(e)}),this.register(function(e){return new Ye(e)}),this.register(function(e){return new Qe(e)}),this.register(function(e){return new je(e)}),this.register(function(e){return new ze(e)}),this.register(function(e){return new We(e)}),this.register(function(e){return new Ve(e)}),this.register(function(e){return new Be(e)}),this.register(function(e){return new Xe(e)}),this.register(function(e){return new He(e)}),this.register(function(e){return new $e(e)}),this.register(function(e){return new qe(e)}),this.register(function(e){return new Oe(e)}),this.register(function(e){return new Ze(e)}),this.register(function(e){return new Je(e)})}load(e,t,r,n){const o=this;let i;if(""!==this.resourcePath)i=this.resourcePath;else if(""!==this.path){const t=s.extractUrlBase(e);i=s.resolveURL(t,this.path)}else i=s.extractUrlBase(e);this.manager.itemStart(e);const l=function(t){n?n(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},c=new a(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(r){try{o.parse(r,i,function(r){t(r),o.manager.itemEnd(e)},l)}catch(e){l(e)}},r,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let o;const s={},a={},i=new TextDecoder;if("string"==typeof e)o=JSON.parse(e);else if(e instanceof ArrayBuffer){if(i.decode(new Uint8Array(e,0,4))===et){try{s[Pe.KHR_BINARY_GLTF]=new nt(e)}catch(e){return void(n&&n(e))}o=JSON.parse(s[Pe.KHR_BINARY_GLTF].content)}else o=JSON.parse(i.decode(e))}else o=e;if(void 0===o.asset||o.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new kt(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[t.name]=t,s[t.name]=!0}if(o.extensionsUsed)for(let e=0;e<o.extensionsUsed.length;++e){const t=o.extensionsUsed[e],r=o.extensionsRequired||[];switch(t){case Pe.KHR_MATERIALS_UNLIT:s[t]=new Ge;break;case Pe.KHR_DRACO_MESH_COMPRESSION:s[t]=new ot(o,this.dracoLoader);break;case Pe.KHR_TEXTURE_TRANSFORM:s[t]=new st;break;case Pe.KHR_MESH_QUANTIZATION:s[t]=new at;break;default:r.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(a),l.parse(r,n)}parseAsync(e,t){const r=this;return new Promise(function(n,o){r.parse(e,t,n,o)})}}function De(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Pe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Oe{constructor(e){this.parser=e,this.name=Pe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let n=t.cache.get(r);if(n)return n;const o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let a;const i=new c(16777215);void 0!==s.color&&i.setRGB(s.color[0],s.color[1],s.color[2],u);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new p(i),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new f(i),a.distance=l;break;case"spot":a=new d(i),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,wt(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),n=Promise.resolve(a),t.cache.add(r,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,n=r.json.nodes[e],o=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then(function(e){return r._getNodeRef(t.cache,o,e)})}}class Ge{constructor(){this.name=Pe.KHR_MATERIALS_UNLIT}getMaterialType(){return N}extendParams(e,t,r){const n=[];e.color=new c(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const t=o.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],u),e.opacity=t[3]}void 0!==o.baseColorTexture&&n.push(r.assignTexture(e,"map",o.baseColorTexture,h))}return Promise.all(n)}}class Be{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class Ne{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&o.push(r.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&o.push(r.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(o.push(r.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l(e,e)}return Promise.all(o)}}class He{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&o.push(r.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&o.push(r.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(o)}}class je{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new c(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=n.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],u)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&o.push(r.assignTexture(t,"sheenColorMap",s.sheenColorTexture,h)),void 0!==s.sheenRoughnessTexture&&o.push(r.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}}class ze{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&o.push(r.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(o)}}class We{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&o.push(r.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=(new c).setRGB(a[0],a[1],a[2],u),Promise.all(o)}}class Ve{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class Xe{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&o.push(r.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=(new c).setRGB(a[0],a[1],a[2],u),void 0!==s.specularColorTexture&&o.push(r.assignTexture(t,"specularColorMap",s.specularColorTexture,h)),Promise.all(o)}}class qe{constructor(e){this.parser=e,this.name=Pe.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&o.push(r.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(o)}}class $e{constructor(e){this.parser=e,this.name=Pe.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&o.push(r.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(o)}}class Ke{constructor(e){this.parser=e,this.name=Pe.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,s)}}class Ye{constructor(e){this.parser=e,this.name=Pe.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const s=o.extensions[t],a=n.images[s.source];let i=r.textureLoader;if(a.uri){const e=r.options.manager.getHandler(a.uri);null!==e&&(i=e)}return this.detectSupport().then(function(o){if(o)return r.loadTextureImage(e,s.source,i);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Qe{constructor(e){this.parser=e,this.name=Pe.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const s=o.extensions[t],a=n.images[s.source];let i=r.textureLoader;if(a.uri){const e=r.options.manager.getHandler(a.uri);null!==e&&(i=e)}return this.detectSupport().then(function(o){if(o)return r.loadTextureImage(e,s.source,i);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Ze{constructor(e){this.name=Pe.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(t){const r=e.byteOffset||0,n=e.byteLength||0,s=e.count,a=e.byteStride,i=new Uint8Array(t,r,n);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(s,a,i,e.mode,e.filter).then(function(e){return e.buffer}):o.ready.then(function(){const t=new ArrayBuffer(s*a);return o.decodeGltfBuffer(new Uint8Array(t),s,a,i,e.mode,e.filter),t})})}return null}}class Je{constructor(e){this.name=Pe.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;const n=t.meshes[r.mesh];for(const e of n.primitives)if(e.mode!==ut.TRIANGLES&&e.mode!==ut.TRIANGLE_STRIP&&e.mode!==ut.TRIANGLE_FAN&&void 0!==e.mode)return null;const o=r.extensions[this.name].attributes,s=[],a={};for(const e in o)s.push(this.parser.getDependency("accessor",o[e]).then(t=>(a[e]=t,a[e])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{const t=e.pop(),r=t.isGroup?t.children:[t],n=e[0].count,o=[];for(const e of r){const t=new g,r=new m,s=new v,i=new m(1,1,1),l=new y(e.geometry,e.material,n);for(let e=0;e<n;e++)a.TRANSLATION&&r.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,e),a.SCALE&&i.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(r,s,i));for(const t in a)if("_COLOR_0"===t){const e=a[t];l.instanceColor=new x(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);b.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),o.push(l)}return t.isGroup?(t.clear(),t.add(...o),t):o[0]}))}}const et="glTF",tt=1313821514,rt=5130562;class nt{constructor(e){this.name=Pe.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==et)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,o=new DataView(e,12);let s=0;for(;s<n;){const t=o.getUint32(s,!0);s+=4;const n=o.getUint32(s,!0);if(s+=4,n===tt){const n=new Uint8Array(e,12+s,t);this.content=r.decode(n)}else if(n===rt){const r=12+s;this.body=e.slice(r,r+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ot{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Pe.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},i={},l={};for(const e in s){const t=gt[e]||e.toLowerCase();a[t]=s[e]}for(const t in e.attributes){const n=gt[t]||t.toLowerCase();if(void 0!==s[t]){const o=r.accessors[e.attributes[t]],s=ht[o.componentType];l[n]=s.name,i[n]=!0===o.normalized}}return t.getDependency("bufferView",o).then(function(e){return new Promise(function(t,r){n.decodeDracoFile(e,function(e){for(const t in e.attributes){const r=e.attributes[t],n=i[t];void 0!==n&&(r.normalized=n)}t(e)},a,l,u,r)})})}}class st{constructor(){this.name=Pe.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class at{constructor(){this.name=Pe.KHR_MESH_QUANTIZATION}}class it extends ue{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,o=e*n*3+n;for(let e=0;e!==n;e++)t[e]=r[o+e];return t}interpolate_(e,t,r,n){const o=this.resultBuffer,s=this.sampleValues,a=this.valueSize,i=2*a,l=3*a,c=n-t,u=(r-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,g=-2*d+3*h,m=d-h,v=1-g,y=m-h+u;for(let e=0;e!==a;e++){const t=s[p+e+a],r=s[p+e+i]*c,n=s[f+e+a],l=s[f+e]*c;o[e]=v*t+y*r+g*n+m*l}return o}}const lt=new v;class ct extends it{interpolate_(e,t,r,n){const o=super.interpolate_(e,t,r,n);return lt.fromArray(o).normalize().toArray(o),o}}const ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ht={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},dt={9728:I,9729:E,9984:k,9985:C,9986:U,9987:R},ft={33071:F,33648:M,10497:L},pt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},mt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},vt={CUBICSPLINE:void 0,LINEAR:ne,STEP:re},yt="OPAQUE",xt="MASK",bt="BLEND";function St(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new G({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ce})),e.DefaultMaterial}function Tt(e,t,r){for(const n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function wt(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function At(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function _t(e){let t;const r=e.extensions&&e.extensions[Pe.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+Rt(r.attributes):e.indices+":"+Rt(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,n=e.targets.length;r<n;r++)t+=":"+Rt(e.targets[r]);return t}function Rt(e){let t="";const r=Object.keys(e).sort();for(let n=0,o=r.length;n<o;n++)t+=r[n]+":"+e[r[n]]+";";return t}function Ut(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Ct=new g;class kt{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new De,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,n=!1,o=-1;"undefined"!=typeof navigator&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,o=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||n&&o<98?this.textureLoader=new S(this.options.manager):this.textureLoader=new T(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new a(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,n=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){const s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};return Tt(o,s,n),wt(s,n),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const n=r.clone(),o=(e,t)=>{const r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(const[r,n]of e.children.entries())o(n,t.children[r])};return o(r,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const n=e(t[r]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let n=0;n<t.length;n++){const o=e(t[n]);o&&r.push(o)}return r}getDependency(e,t){const r=e+":"+t;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":n=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Pe.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(e,o){r.load(s.resolveURL(t.uri,n.path),e,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})}loadAccessor(e){const t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){const e=pt[n.type],t=ht[n.componentType],r=!0===n.normalized,o=new t(n.count*e);return Promise.resolve(new w(o,e,r))}const o=[];return void 0!==n.bufferView?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),void 0!==n.sparse&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then(function(e){const o=e[0],s=pt[n.type],a=ht[n.componentType],i=a.BYTES_PER_ELEMENT,l=i*s,c=n.byteOffset||0,u=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,h=!0===n.normalized;let d,f;if(u&&u!==l){const e=Math.floor(c/u),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let l=t.cache.get(r);l||(d=new a(o,e*u,n.count*u/i),l=new A(d,u/i),t.cache.add(r,l)),f=new _(l,s,c%u/i,h)}else d=null===o?new a(n.count*s):new a(o,c,n.count*s),f=new w(d,s,h);if(void 0!==n.sparse){const t=pt.SCALAR,r=ht[n.sparse.indices.componentType],i=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,c=new r(e[1],i,n.sparse.count*t),u=new a(e[2],l,n.sparse.count*s);null!==o&&(f=new w(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(f.setX(t,u[e*s]),s>=2&&f.setY(t,u[e*s+1]),s>=3&&f.setZ(t,u[e*s+2]),s>=4&&f.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})}loadTexture(e){const t=this.json,r=this.options,n=t.textures[e].source,o=t.images[n];let s=this.textureLoader;if(o.uri){const e=r.manager.getHandler(o.uri);null!==e&&(s=e)}return this.loadTextureImage(e,n,s)}loadTextureImage(e,t,r){const n=this,o=this.json,s=o.textures[e],a=o.images[t],i=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[i])return this.textureCache[i];const l=this.loadImageSource(t,r).then(function(t){t.flipY=!1,t.name=s.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const r=(o.samplers||{})[s.sampler]||{};return t.magFilter=dt[r.magFilter]||E,t.minFilter=dt[r.minFilter]||R,t.wrapS=ft[r.wrapS]||L,t.wrapT=ft[r.wrapT]||L,n.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[i]=l,l}loadImageSource(e,t){const r=this,n=this.json,o=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const a=n.images[e],i=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(void 0!==a.bufferView)l=r.getDependency("bufferView",a.bufferView).then(function(e){c=!0;const t=new Blob([e],{type:a.mimeType});return l=i.createObjectURL(t),l});else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(e){return new Promise(function(r,n){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){const t=new oe(e);t.needsUpdate=!0,r(t)}),t.load(s.resolveURL(e,o.path),a,void 0,n)})}).then(function(e){var t;return!0===c&&i.revokeObjectURL(l),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=u,u}assignTexture(e,t,r,n){const o=this;return this.getDependency("texture",r.index).then(function(s){if(!s)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((s=s.clone()).channel=r.texCoord),o.extensions[Pe.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[Pe.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=o.associations.get(s);s=o.extensions[Pe.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),o.associations.set(s,t)}}return void 0!==n&&(s.colorSpace=n),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const n=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new D,P.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new O,P.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(n||o||s){let e="ClonedMaterial:"+r.uuid+":";n&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),o&&(t.vertexColors=!0),s&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return G}loadMaterial(e){const t=this,r=this.json,n=this.extensions,o=r.materials[e];let s;const a={},i=[];if((o.extensions||{})[Pe.KHR_MATERIALS_UNLIT]){const e=n[Pe.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),i.push(e.extendParams(a,o,t))}else{const r=o.pbrMetallicRoughness||{};if(a.color=new c(1,1,1),a.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],u),a.opacity=e[3]}void 0!==r.baseColorTexture&&i.push(t.assignTexture(a,"map",r.baseColorTexture,h)),a.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,a.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(i.push(t.assignTexture(a,"metalnessMap",r.metallicRoughnessTexture)),i.push(t.assignTexture(a,"roughnessMap",r.metallicRoughnessTexture))),s=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),i.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)})))}!0===o.doubleSided&&(a.side=B);const d=o.alphaMode||yt;if(d===bt?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===xt&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&s!==N&&(i.push(t.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new l(1,1),void 0!==o.normalTexture.scale)){const e=o.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==o.occlusionTexture&&s!==N&&(i.push(t.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&s!==N){const e=o.emissiveFactor;a.emissive=(new c).setRGB(e[0],e[1],e[2],u)}return void 0!==o.emissiveTexture&&s!==N&&i.push(t.assignTexture(a,"emissiveMap",o.emissiveTexture,h)),Promise.all(i).then(function(){const r=new s(a);return o.name&&(r.name=o.name),wt(r,o),t.associations.set(r,{materials:e}),o.extensions&&Tt(n,r,o),r})}createUniqueName(e){const t=H.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,n=this.primitiveCache;function o(e){return r[Pe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return Et(r,e,t)})}const s=[];for(let r=0,a=e.length;r<a;r++){const a=e[r],i=_t(a),l=n[i];if(l)s.push(l.promise);else{let e;e=a.extensions&&a.extensions[Pe.KHR_DRACO_MESH_COMPRESSION]?o(a):Et(new j,a,t),n[i]={primitive:a,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,o=this.json,s=this.extensions,a=o.meshes[e],i=a.primitives,l=[];for(let e=0,t=i.length;e<t;e++){const t=void 0===i[e].material?St(this.cache):this.getDependency("material",i[e].material);l.push(t)}return l.push(t.loadGeometries(i)),Promise.all(l).then(function(o){const l=o.slice(0,o.length-1),c=o[o.length-1],u=[];for(let o=0,h=c.length;o<h;o++){const h=c[o],d=i[o];let f;const p=l[o];if(d.mode===ut.TRIANGLES||d.mode===ut.TRIANGLE_STRIP||d.mode===ut.TRIANGLE_FAN||void 0===d.mode)f=!0===a.isSkinnedMesh?new z(h,p):new W(h,p),!0===f.isSkinnedMesh&&f.normalizeSkinWeights(),d.mode===ut.TRIANGLE_STRIP?f.geometry=Me(f.geometry,n):d.mode===ut.TRIANGLE_FAN&&(f.geometry=Me(f.geometry,r));else if(d.mode===ut.LINES)f=new V(h,p);else if(d.mode===ut.LINE_STRIP)f=new X(h,p);else if(d.mode===ut.LINE_LOOP)f=new q(h,p);else{if(d.mode!==ut.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);f=new $(h,p)}Object.keys(f.geometry.morphAttributes).length>0&&At(f,a),f.name=t.createUniqueName(a.name||"mesh_"+e),wt(f,a),d.extensions&&Tt(s,f,d),t.assignFinalMaterial(f),u.push(f)}for(let r=0,n=u.length;r<n;r++)t.associations.set(u[r],{meshes:e,primitives:r});if(1===u.length)return a.extensions&&Tt(s,u[0],a),u[0];const h=new K;a.extensions&&Tt(s,h,a),t.associations.set(h,{meshes:e});for(let e=0,t=u.length;e<t;e++)h.add(u[e]);return h})}loadCamera(e){let t;const r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new Y(Q.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new Z(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),wt(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r=[];for(let e=0,n=t.joints.length;e<n;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(e){const r=e.pop(),n=e,o=[],s=[];for(let e=0,a=n.length;e<a;e++){const a=n[e];if(a){o.push(a);const t=new g;null!==r&&t.fromArray(r.array,16*e),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new J(o,s)})}loadAnimation(e){const t=this.json,r=this,n=t.animations[e],o=n.name?n.name:"animation_"+e,s=[],a=[],i=[],l=[],c=[];for(let e=0,t=n.channels.length;e<t;e++){const t=n.channels[e],r=n.samplers[t.sampler],o=t.target,u=o.node,h=void 0!==n.parameters?n.parameters[r.input]:r.input,d=void 0!==n.parameters?n.parameters[r.output]:r.output;void 0!==o.node&&(s.push(this.getDependency("node",u)),a.push(this.getDependency("accessor",h)),i.push(this.getDependency("accessor",d)),l.push(r),c.push(o))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(i),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],n=e[1],s=e[2],a=e[3],i=e[4],l=[];for(let e=0,o=t.length;e<o;e++){const o=t[e],c=n[e],u=s[e],h=a[e],d=i[e];if(void 0===o)continue;o.updateMatrix&&o.updateMatrix();const f=r._createAnimationTracks(o,c,u,h,d);if(f)for(let e=0;e<f.length;e++)l.push(f[e])}return new ee(o,void 0,l)})}createNodeMesh(e){const t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then(function(e){const t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]}),t})}loadNode(e){const t=this,r=this.json.nodes[e],n=t._loadNodeShallow(e),o=[],s=r.children||[];for(let e=0,r=s.length;e<r;e++)o.push(t.getDependency("node",s[e]));const a=void 0===r.skin?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([n,Promise.all(o),a]).then(function(e){const t=e[0],r=e[1],n=e[2];null!==n&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(n,Ct)});for(let e=0,n=r.length;e<n;e++)t.add(r[e]);return t})}_loadNodeShallow(e){const t=this.json,r=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const o=t.nodes[e],s=o.name?n.createUniqueName(o.name):"",a=[],i=n._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return i&&a.push(i),void 0!==o.camera&&a.push(n.getDependency("camera",o.camera).then(function(e){return n._getNodeRef(n.cameraCache,o.camera,e)})),n._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){a.push(e)}),this.nodeCache[e]=Promise.all(a).then(function(t){let a;if(a=!0===o.isBone?new te:t.length>1?new K:1===t.length?t[0]:new b,a!==t[0])for(let e=0,r=t.length;e<r;e++)a.add(t[e]);if(o.name&&(a.userData.name=o.name,a.name=s),wt(a,o),o.extensions&&Tt(r,a,o),void 0!==o.matrix){const e=new g;e.fromArray(o.matrix),a.applyMatrix4(e)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=e,a}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],n=this,o=new K;r.name&&(o.name=n.createUniqueName(r.name)),wt(o,r),r.extensions&&Tt(t,o,r);const s=r.nodes||[],a=[];for(let e=0,t=s.length;e<t;e++)a.push(n.getDependency("node",s[e]));return Promise.all(a).then(function(e){for(let t=0,r=e.length;t<r;t++)o.add(e[t]);return n.associations=(e=>{const t=new Map;for(const[e,r]of n.associations)(e instanceof P||e instanceof oe)&&t.set(e,r);return e.traverse(e=>{const r=n.associations.get(e);null!=r&&t.set(e,r)}),t})(o),o})}_createAnimationTracks(e,t,r,n,o){const s=[],a=e.name?e.name:e.uuid,i=[];let l;switch(mt[o.path]===mt.weights?e.traverse(function(e){e.morphTargetInfluences&&i.push(e.name?e.name:e.uuid)}):i.push(a),mt[o.path]){case mt.weights:l=ae;break;case mt.rotation:l=ie;break;case mt.position:case mt.scale:l=se;break;default:if(1===r.itemSize)l=ae;else l=se}const c=void 0!==n.interpolation?vt[n.interpolation]:ne,u=this._getArrayFromAccessor(r);for(let e=0,r=i.length;e<r;e++){const r=new l(i[e]+"."+mt[o.path],t.array,u,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(r),s.push(r)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Ut(t.constructor),r=new Float32Array(t.length);for(let n=0,o=t.length;n<o;n++)r[n]=t[n]*e;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof ie?ct:it)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Et(e,t,r){const n=t.attributes,o=[];function s(t,n){return r.getDependency("accessor",t).then(function(t){e.setAttribute(n,t)})}for(const t in n){const r=gt[t]||t.toLowerCase();r in e.attributes||o.push(s(n[t],r))}if(void 0!==t.indices&&!e.index){const n=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(n)}return le.workingColorSpace!==u&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${le.workingColorSpace}" not supported.`),wt(e,t),function(e,t,r){const n=t.attributes,o=new he;if(void 0===n.POSITION)return;{const e=r.json.accessors[n.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new m(t[0],t[1],t[2]),new m(s[0],s[1],s[2])),e.normalized){const t=Ut(ht[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new m,t=new m;for(let n=0,o=s.length;n<o;n++){const o=s[n];if(void 0!==o.POSITION){const n=r.json.accessors[o.POSITION],s=n.min,a=n.max;if(void 0!==s&&void 0!==a){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),n.normalized){const e=Ut(ht[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const a=new de;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=a}(e,t,r),Promise.all(o).then(function(){return void 0!==t.targets?function(e,t,r){let n=!1,o=!1,s=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(o=!0),void 0!==r.COLOR_0&&(s=!0),n&&o&&s)break}if(!n&&!o&&!s)return Promise.resolve(e);const a=[],i=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(n){const t=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;a.push(t)}if(o){const t=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal;i.push(t)}if(s){const t=void 0!==u.COLOR_0?r.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(i),Promise.all(l)]).then(function(t){const r=t[0],a=t[1],i=t[2];return n&&(e.morphAttributes.position=r),o&&(e.morphAttributes.normal=a),s&&(e.morphAttributes.color=i),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}const It={ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Lt(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function Mt(e,t,r=null,n=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const o=await async function(e){if(!e)throw new Error("No basePath supplied");return await Lt(`${e}/profilesList.json`)}(t);let s;if(e.profiles.some(e=>{const r=o[e];return r&&(s={profileId:e,profilePath:`${t}/${r.path}`,deprecated:!!r.deprecated}),!!s}),!s){if(!r)throw new Error("No matching profile name found");const e=o[r];if(!e)throw new Error(`No matching profile name found and default profile "${r}" missing.`);s={profileId:r,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const a=await Lt(s.profilePath);let i;if(n){let t;if(t="any"===e.handedness?a.layouts[Object.keys(a.layouts)[0]]:a.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${s.profileId}`);t.assetPath&&(i=s.profilePath.replace("profile.json",t.assetPath))}return{profile:a,assetPath:i}}const Ft={xAxis:0,yAxis:0,button:0,state:It.ComponentState.DEFAULT};class Dt{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===It.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Ft)}updateFromComponent({xAxis:e,yAxis:t,button:r,state:n}){const{normalizedXAxis:o,normalizedYAxis:s}=function(e=0,t=0){let r=e,n=t;if(Math.sqrt(e*e+t*t)>1){const o=Math.atan2(t,e);r=Math.cos(o),n=Math.sin(o)}return{normalizedXAxis:.5*r+.5,normalizedYAxis:.5*n+.5}}(e,t);switch(this.componentProperty){case It.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?o:.5;break;case It.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?s:.5;break;case It.ComponentProperty.BUTTON:this.value=this.states.includes(n)?r:0;break;case It.ComponentProperty.STATE:this.valueNodeProperty===It.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Pt{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(e=>{const r=new Dt(t.visualResponses[e]);this.visualResponses[e]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:It.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=It.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=It.ComponentState.PRESSED:(t.touched||this.values.button>It.ButtonTouchThreshold)&&(this.values.state=It.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===It.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>It.AxisTouchThreshold&&(this.values.state=It.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===It.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>It.AxisTouchThreshold&&(this.values.state=It.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class Ot{constructor(e,t,r){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=r,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(e=>{const t=this.layoutDescription.components[e];this.components[e]=new Pt(e,t)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}class Gt extends b{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)})),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(e=>{const{valueNode:t,minNode:r,maxNode:n,value:o,valueNodeProperty:s}=e;t&&(s===It.VisualResponseProperty.VISIBILITY?t.visible=o:s===It.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(r.quaternion,n.quaternion,o),t.position.lerpVectors(r.position,n.position,o)))})}))}}function Bt(e,t){!function(e,t){Object.values(e.components).forEach(e=>{const{type:r,touchPointNodeName:n,visualResponses:o}=e;if(r===It.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(n),e.touchPointNode){const t=new fe(.001),r=new N({color:255}),n=new W(t,r);e.touchPointNode.add(n)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach(e=>{const{valueNodeName:r,minNodeName:n,maxNodeName:o,valueNodeProperty:s}=e;if(s===It.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(n),e.maxNode=t.getObjectByName(o),!e.minNode)return void console.warn(`Could not find ${n} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${o} in the model`)}e.valueNode=t.getObjectByName(r),e.valueNode||console.warn(`Could not find ${r} in the model`)})})}(e.motionController,t),e.envMap&&t.traverse(t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)}),e.add(t)}class Nt{constructor(e=null,t=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new Fe)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new Gt;let r=null;return e.addEventListener("connected",e=>{const n=e.data;"tracked-pointer"===n.targetRayMode&&n.gamepad&&Mt(n,this.path,"generic-trigger").then(({profile:e,assetPath:o})=>{t.motionController=new Ot(n,e,o);const s=this._assetCache[t.motionController.assetUrl];if(s)r=s.scene.clone(),Bt(t,r),this.onLoad&&this.onLoad(r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,e=>{this._assetCache[t.motionController.assetUrl]=e,r=e.scene.clone(),Bt(t,r),this.onLoad&&this.onLoad(r)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(e=>{console.warn(e)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(r),r=null}),t}}class Ht extends pe{constructor(e){super(e),this.type=ge}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},r=function(e,t,r){t=t||1024;let n=e.pos,o=-1,s=0,a="",i=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(o=i.indexOf("\n"))&&s<t&&n<e.byteLength;)a+=i,s+=i.length,n+=128,i+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<o&&(e.pos+=s+o+1,a+i.slice(0,o))},n=function(e,t,r,n){const o=e[t+3],s=Math.pow(2,o-128)/255;r[n+0]=e[t+0]*s,r[n+1]=e[t+1]*s,r[n+2]=e[t+2]*s,r[n+3]=1},o=function(e,t,r,n){const o=e[t+3],s=Math.pow(2,o-128)/255;r[n+0]=ve.toHalfFloat(Math.min(e[t+0]*s,65504)),r[n+1]=ve.toHalfFloat(Math.min(e[t+1]*s,65504)),r[n+2]=ve.toHalfFloat(Math.min(e[t+2]*s,65504)),r[n+3]=ve.toHalfFloat(1)},s=new Uint8Array(e);s.pos=0;const a=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,i={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=r(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),i.valid|=1,i.programtype=c[1],i.string+=l+"\n";l=r(e),!1!==l;)if(i.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(n))&&(i.gamma=parseFloat(c[1])),(c=l.match(o))&&(i.exposure=parseFloat(c[1])),(c=l.match(s))&&(i.valid|=2,i.format=c[1]),(c=l.match(a))&&(i.valid|=4,i.height=parseInt(c[1],10),i.width=parseInt(c[2],10)),2&i.valid&&4&i.valid)break}else i.comments+=l+"\n";return 2&i.valid||t(3,"missing format specifier"),4&i.valid||t(3,"missing image size specifier"),i}(s),i=a.width,l=a.height,c=function(e,r,n){const o=r;if(o<8||o>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);o!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const s=new Uint8Array(4*r*n);s.length||t(4,"unable to allocate buffer space");let a=0,i=0;const l=4*o,c=new Uint8Array(4),u=new Uint8Array(l);let h=n;for(;h>0&&i<e.byteLength;){i+4>e.byteLength&&t(1),c[0]=e[i++],c[1]=e[i++],c[2]=e[i++],c[3]=e[i++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==o||t(3,"bad rgbe scanline format");let r,n=0;for(;n<l&&i<e.byteLength;){r=e[i++];const o=r>128;if(o&&(r-=128),(0===r||n+r>l)&&t(3,"bad scanline data"),o){const t=e[i++];for(let e=0;e<r;e++)u[n++]=t}else u.set(e.subarray(i,i+r),n),n+=r,i+=r}const d=o;for(let e=0;e<d;e++){let t=0;s[a]=u[e+t],t+=o,s[a+1]=u[e+t],t+=o,s[a+2]=u[e+t],t+=o,s[a+3]=u[e+t],a+=4}h--}return s}(s.subarray(s.pos),i,l);let u,h,d;switch(this.type){case me:d=c.length/4;const e=new Float32Array(4*d);for(let t=0;t<d;t++)n(c,4*t,e,4*t);u=e,h=me;break;case ge:d=c.length/4;const t=new Uint16Array(4*d);for(let e=0;e<d;e++)o(c,4*e,t,4*e);u=t,h=ge;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:i,height:l,data:u,header:a.string,gamma:a.gamma,exposure:a.exposure,type:h}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){switch(e.type){case me:case ge:e.colorSpace=u,e.minFilter=E,e.magFilter=E,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}}class jt{Player;Scene;Camera;Renderer;LoadingManager;Clock;AudioListener;AudioLoader;LeftController;RightController;LeftControllerGrip;RightControllerGrip;Controllers;AmbientLight;DirectionalLight;HemisphereLight;constructor(){this.LoadingManager=new e.LoadingManager,this.Clock=new e.Clock,this.Player=new e.Group,this.Player.name="player",this.AudioListener=new e.AudioListener,this.AudioLoader=new e.AudioLoader(this.LoadingManager),this.Scene=new e.Scene,this.Scene.background=new e.Color(8421504),this.Camera=new e.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),this.Camera.position.set(0,1.6,0),this.Camera.add(this.AudioListener),this.Player.add(this.Camera),this.Renderer=new e.WebGLRenderer({antialias:!0,powerPreference:"high-performance",depth:!0}),this.Renderer.setPixelRatio(window.devicePixelRatio),this.Renderer.setSize(window.innerWidth,window.innerHeight),this.Renderer.xr.enabled=!0,this.Renderer.localClippingEnabled=!0,this.Renderer.toneMapping=e.ACESFilmicToneMapping,this.Renderer.outputColorSpace=e.SRGBColorSpace,window.addEventListener("resize",this._onResize),this._setupLighting(),this._setupControllers(),this.Scene.add(this.Player)}_onResize=()=>{this.Camera.aspect=window.innerWidth/window.innerHeight,this.Camera.updateProjectionMatrix(),this.Renderer.setSize(window.innerWidth,window.innerHeight)};_setupLighting(){this.HemisphereLight=new e.HemisphereLight(6316128,4210752),this.Scene.add(this.HemisphereLight),this.AmbientLight=new e.AmbientLight(16777215,.3),this.Scene.add(this.AmbientLight),this.DirectionalLight=new e.DirectionalLight(16777215,3),this.DirectionalLight.position.set(1,1,1).normalize(),this.Scene.add(this.DirectionalLight)}_setupControllers(){const e=new Fe(this.LoadingManager),t=new Nt(e);this.RightController=this.Renderer.xr.getController(0),this.LeftController=this.Renderer.xr.getController(1),this.LeftController.userData={handedness:"left",isSelecting:!1},this.RightController.userData={handedness:"right",isSelecting:!1},this.RightControllerGrip=this.Renderer.xr.getControllerGrip(0),this.LeftControllerGrip=this.Renderer.xr.getControllerGrip(1),this.RightControllerGrip.add(t.createControllerModel(this.RightControllerGrip)),this.LeftControllerGrip.add(t.createControllerModel(this.LeftControllerGrip)),this._addLaserPointer(this.LeftController,"left"),this._addLaserPointer(this.RightController,"right"),this.Controllers=[this.LeftController,this.RightController],this.Player.add(this.LeftController,this.RightController),this.Player.add(this.LeftControllerGrip,this.RightControllerGrip)}_addLaserPointer(t,r){const n=new e.LineBasicMaterial({color:16777215,transparent:!0,opacity:.6}),o=(new e.BufferGeometry).setFromPoints([new e.Vector3(0,0,0),new e.Vector3(0,0,-1)]),s=new e.Line(o,n);s.name=`line-${r}`,s.frustumCulled=!1,t.add(s)}setEnv(t){const{url:r,isEnv:n=!0,isBackground:o=!1,onLoaded:s}=t;if(!r)return;const a=new Ht(this.LoadingManager),i=new e.PMREMGenerator(this.Renderer);i.compileEquirectangularShader(),a.load(r,e=>{const t=i.fromEquirectangular(e).texture;e.dispose(),i.dispose(),n&&(this.Scene.environment=t),o&&(this.Scene.background=t),s?.(t)},void 0,e=>{console.error(`[Engine] Failed to load environment: ${r}`,e)})}render(){this.Renderer.render(this.Scene,this.Camera)}}const zt={VR:class extends jt{constructor(e){super(),e?.appendChild(Ie.createButton(this.Renderer,{optionalFeatures:Le}))}}};class Wt{dom;ctx;static WIDTH=256;static HEIGHT=128;constructor(){this.dom=document.createElement("canvas"),this.dom.width=Wt.WIDTH,this.dom.height=Wt.HEIGHT;const e=this.dom.getContext("2d");if(!e)throw new Error("Canvas 2D context is not supported or already initialized.");this.ctx=e,this.applyStyles()}update(e){const t=e.info;this.ctx.clearRect(0,0,this.dom.width,this.dom.height),this.ctx.fillStyle="#ffffff",this.ctx.font="14px monospace",this.ctx.textBaseline="top",this.ctx.fillText("Stats",10,10),this.ctx.fillText(`Triangles: ${t.render.triangles}`,10,30),this.ctx.fillText(`Draw Calls: ${t.render.calls}`,10,50),this.ctx.fillText(`Geometries: ${t.memory.geometries}`,10,70),this.ctx.fillText(`Textures: ${t.memory.textures}`,10,90)}applyStyles(){Object.assign(this.dom.style,{position:"fixed",top:"1rem",left:"1rem",background:"rgba(0, 0, 0, 0.8)",color:"#fff",padding:"0.75rem 1rem",borderRadius:"0.5rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:"10000",pointerEvents:"none",fontFamily:"monospace",fontSize:"clamp(10px, 1.2vw, 14px)",width:`${Wt.WIDTH}px`,height:`${Wt.HEIGHT}px`})}}class Vt extends Ce{controllers=[];renderer=null}Vt.schema={controllers:{type:Ue.Array,default:[]},renderer:{type:Ue.Ref,default:null}};class Xt extends Ce{object=new e.Mesh}Xt.schema={object:{type:Ue.Ref,default:new e.Mesh}};class qt extends Ce{currState="none";prevState="none";isScaled=!1;clickSound;isClickSound=!1;hoverSound;isHoverSound=!1;onClick=()=>{}}qt.schema={currState:{type:Ue.String,default:"none"},prevState:{type:Ue.String,default:"none"},isScaled:{type:Ue.Boolean,default:!1},clickSound:{type:Ue.Ref,default:null},isClickSound:{type:Ue.Boolean,default:!1},hoverSound:{type:Ue.Ref,default:null},isHoverSound:{type:Ue.Boolean,default:!1},onClick:{type:Ue.Ref,default:()=>{}}};class $t extends ke{previousButtonStates;init(e){this.previousButtonStates={left:[],right:[]}}execute(e,t){this.queries.controllers.results.forEach(e=>{const t=e.getComponent(Vt);if(!t)return;const r=t?.renderer.xr.getSession(),n=e.getComponent(Xt)?.object;r&&(n?r.inputSources.forEach(r=>{t.controllers.forEach(t=>{const o=t.userData.handedness;if(r.handedness!==o)return;const s=this._getIntersections(t,n);if(s.length>0){const n=s[0];if(t.userData.lineReset&&(t.userData.lineReset=!1),t.userData.isHover||(t.userData.isHover=!0),"gamepad"in r&&r.gamepad){const o=r.gamepad;this._onHover(e,o),this._updateLine(t,n),o.buttons.forEach((r,s)=>{this._handleButton(r,s,t,e,n,o)})}}else t.userData.lineReset||(this._resetLine(t),t.userData.lineReset=!0),t.userData.isHover&&e.hasComponent(qt)&&this._onUnhover(e)})}):console.error("object is not defined."))})}_updateLine(e,t){const r=e.getObjectByName(`line-${e.userData.handedness}`);r&&(r.scale.z=t.distance)}_resetLine(e){const t=e.getObjectByName(`line-${e.userData.handedness}`);t&&(t.scale.z=1)}_updateColor(t,r){const n=t.userData.handedness,o=t.getObjectByName(`line-${n}`);o&&o.material instanceof e.LineBasicMaterial&&o.material.color.set(r)}_handleButton(e,t,r,n,o,s){const a=r.userData.handedness;this.previousButtonStates[a]||(this.previousButtonStates[a]=[]);const i=this.previousButtonStates[a][t]||!1;e.pressed&&!i?(this._StartAction(t,r,n,o),s&&s.hapticActuators&&s.hapticActuators.length>0&&s.hapticActuators[0].pulse(.5,80)):!e.pressed&&i&&this._EndAction(t,r,n),this.previousButtonStates[a][t]=e.pressed}_StartAction(e,t,r,n){0===e&&(this._updateColor(t,2282478),this._handleSelect(t,r))}_EndAction(e,t,r){if(t.userData.selected=!1,r.hasComponent(qt)){const e=r.getMutableComponent(qt);e&&"released"!==e.currState&&(e.currState="released",this._updateColor(t,16777215))}}_handleSelect(e,t){if(t.hasComponent(qt)){const r=t.getMutableComponent(qt);r&&"pressed"!==r.currState&&(r.currState="pressed"),e.userData.selected=!0}}_onHover(e,t){if(!e.hasComponent(qt))return;const r=e.getMutableComponent(qt);r&&"hovered"!==r.currState&&(r.currState="hovered",t&&t.hapticActuators&&t.hapticActuators.length>0&&t.hapticActuators[0].pulse(.2,40))}_onUnhover(e){const t=e.getMutableComponent(qt);t&&"hovered"===t.currState&&(t.currState="none")}_getIntersections(t,r){const n=new e.Matrix4,o=new e.Raycaster;return n.identity().extractRotation(t.matrixWorld),o.ray.origin.setFromMatrixPosition(t.matrixWorld),o.ray.direction.set(0,0,-1).applyMatrix4(n),t.updateMatrixWorld(),o.intersectObject(r,!1)}}$t.queries={controllers:{components:[Vt]}};class Kt extends ke{init(e){}execute(e,t){this.queries.button.results.forEach(e=>{const t=e.getMutableComponent(qt),r=e.getComponent(Xt)?.object;switch(t?.currState){case"pressed":"function"==typeof t.onClick&&t.onClick(),t.isClickSound||(t.clickSound?.play(),t.isClickSound=!0);break;case"hovered":r&&!t.isScaled&&(r.scale.set(1.1,1.1,1.1),t.isScaled=!0),t.isHoverSound||(t.hoverSound?.play(),t.isHoverSound=!0);break;case"released":t.isClickSound&&(t.isClickSound=!1);break;default:r&&t?.isScaled&&(r.scale.set(1,1,1),t.isScaled=!1),t?.isHoverSound&&(t.isHoverSound=!1)}t&&t.prevState!==t.currState&&(t.prevState=t.currState)})}}Kt.queries={button:{components:[qt]}};class Yt{world;constructor(){this.world=new Ee,this._registerComponent(Xt),this._registerComponent(Vt),this._registerComponent(qt),this._registerSystem($t),this._registerSystem(Kt)}createEntity(){return this.world.createEntity()}addFeatures(e={}){const{requiredFeatures:t=[],data:r}=e;for(const e of t)switch(e){case"button":{if(!(r?.renderer&&r.controllers&&r.button?.mesh&&r.button.clickSound&&r.button.hoverSound&&r.button.onClick)){console.warn('[Register] Incomplete data provided for "button" feature.');break}const e=this.createEntity();e.addComponent(Vt,{controllers:r.controllers,renderer:r.renderer}),e.addComponent(Xt,{object:r.button.mesh}),e.addComponent(qt,{clickSound:r.button.clickSound,hoverSound:r.button.hoverSound,onClick:r.button.onClick});break}case"keyboard":console.warn('[Register] Feature "keyboard" is not implemented yet.');break;default:console.warn(`[Register] Unknown feature: "${e}"`)}}update(e,t){this.world.execute(e,t)}_registerComponent(e){this.world.hasRegisteredComponent(e)||this.world.registerComponent(e)}_registerSystem(e){this.world.getSystem(e)||this.world.registerSystem(e)}}function Qt(){var e=Object.create(null);function t(n,o){var s=n.id,a=n.name,i=n.dependencies;void 0===i&&(i=[]);var l=n.init;void 0===l&&(l=function(){});var c=n.getTransferables;if(void 0===c&&(c=null),!e[s])try{i=i.map(function(r){return r&&r.isWorkerModule&&(t(r,function(e){if(e instanceof Error)throw e}),r=e[r.id].value),r}),l=r("<"+a+">.init",l),c&&(c=r("<"+a+">.getTransferables",c));var u=null;"function"==typeof l?u=l.apply(void 0,i):console.error("worker module init function failed to rehydrate"),e[s]={id:s,value:u,getTransferables:c},o(u)}catch(e){e&&e.noLog||console.error(e),o(e)}}function r(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var n=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(n)}catch(e){console.error(e)}return URL.revokeObjectURL(n),delete self.troikaDefine,r}self.addEventListener("message",function(r){var n=r.data,o=n.messageId,s=n.action,a=n.data;try{"registerModule"===s&&t(a,function(e){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===s&&function(t,r){var n,o=t.id,s=t.args;e[o]&&"function"==typeof e[o].value||r(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var a=(n=e[o]).value.apply(n,s);a&&"function"==typeof a.then?a.then(i,function(e){return r(e instanceof Error?e:new Error(""+e))}):i(a)}catch(e){r(e)}function i(t){try{var n=e[o].getTransferables&&e[o].getTransferables(t);n&&Array.isArray(n)&&n.length||(n=void 0),r(t,n)}catch(e){console.error(e),r(e)}}}(a,function(e,t){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:o,success:!1,error:e.stack})}})}var Zt=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){"undefined"!=typeof process&&"test"===process.env.NODE_ENV||console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return Zt=function(){return e},e},Jt=0,er=0,tr=!1,rr=Object.create(null),nr=Object.create(null),or=Object.create(null);function sr(e){if(!(e&&"function"==typeof e.init||tr))throw new Error("requires `options.init` function");var t=e.dependencies,r=e.init,n=e.getTransferables,o=e.workerId,s=function(e){var t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var r=e.dependencies,n=e.init;r=Array.isArray(r)?r.map(function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e}):[];var o=Promise.all(r).then(function(e){return n.apply(null,e)});return t._getInitResult=function(){return o},o},t}(e);null==o&&(o="#default");var a="workerModule"+ ++Jt,i=e.name||a,l=null;function c(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!Zt())return s.apply(void 0,e);if(!l){l=ir(o,"registerModule",c.workerModuleData);var r=function(){l=null,nr[o].delete(r)};(nr[o]||(nr[o]=new Set)).add(r)}return l.then(function(t){if(t.isCallable)return ir(o,"callModule",{id:a,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")})}return t=t&&t.map(function(e){return"function"!=typeof e||e.workerModuleData||(tr=!0,e=sr({workerId:o,name:"<"+i+"> function dependency: "+e.name,init:"function(){return (\n"+ar(e)+"\n)}"}),tr=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),c.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:t,init:ar(r),getTransferables:n&&ar(n)},c.onMainThread=s,c}function ar(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function ir(e,t,r){return new Promise(function(n,o){var s=++er;or[s]=function(e){e.success?n(e.result):o(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=rr[e];if(!t){var r=ar(Qt);(t=rr[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,n=or[r];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete or[r],n(t)}}return t}(e).postMessage({messageId:s,action:t,data:r})})}function lr(){var e=function(e){function t(e,t,r,n,o,s,a,i){var l=1-a;i.x=l*l*e+2*l*a*r+a*a*o,i.y=l*l*t+2*l*a*n+a*a*s}function r(e,t,r,n,o,s,a,i,l,c){var u=1-l;c.x=u*u*u*e+3*u*u*l*r+3*u*l*l*o+l*l*l*a,c.y=u*u*u*t+3*u*u*l*n+3*u*l*l*s+l*l*l*i}function n(e,t){for(var r,n,o,s,a,i=/([MLQCZ])([^MLQCZ]*)/g;r=i.exec(e);){var l=r[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(r[1]){case"M":s=n=l[0],a=o=l[1];break;case"L":l[0]===s&&l[1]===a||t("L",s,a,s=l[0],a=l[1]);break;case"Q":t("Q",s,a,s=l[2],a=l[3],l[0],l[1]);break;case"C":t("C",s,a,s=l[4],a=l[5],l[0],l[1],l[2],l[3]);break;case"Z":s===n&&a===o||t("L",s,a,n,o)}}}function o(e,o,s){void 0===s&&(s=16);var a={x:0,y:0};n(e,function(e,n,i,l,c,u,h,d,f){switch(e){case"L":o(n,i,l,c);break;case"Q":for(var p=n,g=i,m=1;m<s;m++)t(n,i,u,h,l,c,m/(s-1),a),o(p,g,a.x,a.y),p=a.x,g=a.y;break;case"C":for(var v=n,y=i,x=1;x<s;x++)r(n,i,u,h,d,f,l,c,x/(s-1),a),o(v,y,a.x,a.y),v=a.x,y=a.y}})}var s="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(e,t){var r=e.getContext?e.getContext("webgl",i):e,n=a.get(r);if(!n){var o="undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,s={},l={},c={},u=-1,h=[];function d(e){var t=s[e];if(!t&&!(t=s[e]=r.getExtension(e)))throw new Error(e+" not supported");return t}function f(e,t){var n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n}function p(e,t,n,s){if(!l[e]){var a={},i={},c=r.createProgram();r.attachShader(c,f(t,r.VERTEX_SHADER)),r.attachShader(c,f(n,r.FRAGMENT_SHADER)),r.linkProgram(c),l[e]={program:c,transaction:function(e){r.useProgram(c),e({setUniform:function(e,t){for(var n=[],o=arguments.length-2;o-- >0;)n[o]=arguments[o+2];var s=i[t]||(i[t]=r.getUniformLocation(c,t));r["uniform"+e].apply(r,[s].concat(n))},setAttribute:function(e,t,n,s,i){var l=a[e];l||(l=a[e]={buf:r.createBuffer(),loc:r.getAttribLocation(c,e),data:null}),r.bindBuffer(r.ARRAY_BUFFER,l.buf),r.vertexAttribPointer(l.loc,t,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.loc),o?r.vertexAttribDivisor(l.loc,s):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,s),i!==l.data&&(r.bufferData(r.ARRAY_BUFFER,i,n),l.data=i)}})}}}l[e].transaction(s)}function g(e,t){u++;try{r.activeTexture(r.TEXTURE0+u);var n=c[e];n||(n=c[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.bindTexture(r.TEXTURE_2D,n),t(n,u)}finally{u--}}function m(e,t,n){var o=r.createFramebuffer();h.push(o),r.bindFramebuffer(r.FRAMEBUFFER,o),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);try{n(o)}finally{r.deleteFramebuffer(o),r.bindFramebuffer(r.FRAMEBUFFER,h[--h.length-1]||null)}}function v(){s={},l={},c={},u=-1,h.length=0}r.canvas.addEventListener("webglcontextlost",function(e){v(),e.preventDefault()},!1),a.set(r,n={gl:r,isWebGL2:o,getExtension:d,withProgram:p,withTexture:g,withTextureFramebuffer:m,handleContextLoss:v})}t(n)}function c(e,t,r,n,o,a,i,c){void 0===i&&(i=15),void 0===c&&(c=null),l(e,function(e){var l=e.gl,u=e.withProgram;(0,e.withTexture)("copy",function(e,h){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,o,a,0,l.RGBA,l.UNSIGNED_BYTE,t),u("copy",s,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",h),l.bindFramebuffer(l.FRAMEBUFFER,c||null),l.disable(l.BLEND),l.colorMask(8&i,4&i,2&i,1&i),l.viewport(r,n,o,a),l.scissor(r,n,o,a),l.drawArrays(l.TRIANGLES,0,3)})})})}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:function(e,t,r){var n=e.width,o=e.height;l(e,function(s){var a=s.gl,i=new Uint8Array(n*o*4);a.readPixels(0,0,n,o,a.RGBA,a.UNSIGNED_BYTE,i),e.width=t,e.height=r,c(a,i,0,0,n,o)})}});function h(e,t,r,n,s,a){void 0===a&&(a=1);var i=new Uint8Array(e*t),l=n[2]-n[0],c=n[3]-n[1],u=[];o(r,function(e,t,r,n){u.push({x1:e,y1:t,x2:r,y2:n,minX:Math.min(e,r),minY:Math.min(t,n),maxX:Math.max(e,r),maxY:Math.max(t,n)})}),u.sort(function(e,t){return e.maxX-t.maxX});for(var h=0;h<e;h++)for(var d=0;d<t;d++){var f=m(n[0]+l*(h+.5)/e,n[1]+c*(d+.5)/t),g=Math.pow(1-Math.abs(f)/s,a)/2;f<0&&(g=1-g),g=Math.max(0,Math.min(255,Math.round(255*g))),i[d*e+h]=g}return i;function m(e,t){for(var r=1/0,n=1/0,o=u.length;o--;){var s=u[o];if(s.maxX+n<=e)break;if(e+n>s.minX&&t-n<s.maxY&&t+n>s.minY){var a=p(e,t,s.x1,s.y1,s.x2,s.y2);a<r&&(r=a,n=Math.sqrt(r))}}return function(e,t){for(var r=0,n=u.length;n--;){var o=u[n];if(o.maxX<=e)break;o.y1>t!=o.y2>t&&e<(o.x2-o.x1)*(t-o.y1)/(o.y2-o.y1)+o.x1&&(r+=o.y1<o.y2?1:-1)}return 0!==r}(e,t)&&(n=-n),n}}function d(e,t,r,n,o,s,a,i,l,c){void 0===s&&(s=1),void 0===i&&(i=0),void 0===l&&(l=0),void 0===c&&(c=0),f(e,t,r,n,o,s,a,null,i,l,c)}function f(e,t,r,n,o,s,a,i,l,u,d){void 0===s&&(s=1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===d&&(d=0);for(var f=h(e,t,r,n,o,s),p=new Uint8Array(4*f.length),g=0;g<f.length;g++)p[4*g+d]=f[g];c(a,p,l,u,e,t,1<<3-d,i)}function p(e,t,r,n,o,s){var a=o-r,i=s-n,l=a*a+i*i,c=l?Math.max(0,Math.min(1,((e-r)*a+(t-n)*i)/l)):0,u=e-(r+c*a),h=t-(n+c*i);return u*u+h*h}var g=Object.freeze({__proto__:null,generate:h,generateIntoCanvas:d,generateIntoFramebuffer:f}),m=new Float32Array([0,0,2,0,0,2]),v=null,y=!1,x={},b=new WeakMap;function S(e){if(!y&&!_(e))throw new Error("WebGL generation not supported")}function T(e,t,r,n,o,s,a){if(void 0===s&&(s=1),void 0===a&&(a=null),!a&&!(a=v)){var i="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!i)throw new Error("OffscreenCanvas or DOM canvas not supported");a=v=i.getContext("webgl",{depth:!1})}S(a);var c=new Uint8Array(e*t*4);l(a,function(a){var i=a.gl,l=a.withTexture,u=a.withTextureFramebuffer;l("readable",function(a,l){i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),u(a,l,function(a){A(e,t,r,n,o,s,i,a,0,0,0),i.readPixels(0,0,e,t,i.RGBA,i.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(e*t),h=0,d=0;h<c.length;h+=4)u[d++]=c[h];return u}function w(e,t,r,n,o,s,a,i,l,c){void 0===s&&(s=1),void 0===i&&(i=0),void 0===l&&(l=0),void 0===c&&(c=0),A(e,t,r,n,o,s,a,null,i,l,c)}function A(e,t,r,n,a,i,c,u,h,d,f){void 0===i&&(i=1),void 0===h&&(h=0),void 0===d&&(d=0),void 0===f&&(f=0),S(c);var p=[];o(r,function(e,t,r,n){p.push(e,t,r,n)}),p=new Float32Array(p),l(c,function(r){var o=r.gl,l=r.isWebGL2,c=r.getExtension,g=r.withProgram,v=r.withTexture,y=r.withTextureFramebuffer,x=r.handleContextLoss;if(v("rawDistances",function(r,v){e===r._lastWidth&&t===r._lastHeight||o.texImage2D(o.TEXTURE_2D,0,o.RGBA,r._lastWidth=e,r._lastHeight=t,0,o.RGBA,o.UNSIGNED_BYTE,null),g("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(s){var u=s.setAttribute,h=s.setUniform,d=!l&&c("ANGLE_instanced_arrays"),f=!l&&c("EXT_blend_minmax");u("aUV",2,o.STATIC_DRAW,0,m),u("aLineSegment",4,o.DYNAMIC_DRAW,1,p),h.apply(void 0,["4f","uGlyphBounds"].concat(n)),h("1f","uMaxDistance",a),h("1f","uExponent",i),y(r,v,function(r){o.enable(o.BLEND),o.colorMask(!0,!0,!0,!0),o.viewport(0,0,e,t),o.scissor(0,0,e,t),o.blendFunc(o.ONE,o.ONE),o.blendEquationSeparate(o.FUNC_ADD,l?o.MAX:f.MAX_EXT),o.clear(o.COLOR_BUFFER_BIT),l?o.drawArraysInstanced(o.TRIANGLES,0,3,p.length/4):d.drawArraysInstancedANGLE(o.TRIANGLES,0,3,p.length/4)})}),g("post",s,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(r){r.setAttribute("aUV",2,o.STATIC_DRAW,0,m),r.setUniform("1i","tex",v),o.bindFramebuffer(o.FRAMEBUFFER,u),o.disable(o.BLEND),o.colorMask(0===f,1===f,2===f,3===f),o.viewport(h,d,e,t),o.scissor(h,d,e,t),o.drawArrays(o.TRIANGLES,0,3)})}),o.isContextLost())throw x(),new Error("webgl context lost")})}function _(e){var t=e&&e!==v?e.canvas||e:x,r=b.get(t);if(void 0===r){y=!0;var n=null;try{var o=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],s=T(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(r=s&&o.length===s.length&&s.every(function(e,t){return e===o[t]}))||(n="bad trial run results",console.info(o,s))}catch(e){r=!1,n=e.message}n&&console.warn("WebGL SDF generation not supported:",n),y=!1,b.set(t,r)}return r}var R=Object.freeze({__proto__:null,generate:T,generateIntoCanvas:w,generateIntoFramebuffer:A,isSupported:_});return e.forEachPathCommand=n,e.generate=function(e,t,r,n,o,s){void 0===o&&(o=Math.max(n[2]-n[0],n[3]-n[1])/2),void 0===s&&(s=1);try{return T.apply(R,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),h.apply(g,arguments)}},e.generateIntoCanvas=function(e,t,r,n,o,s,a,i,l,c){void 0===o&&(o=Math.max(n[2]-n[0],n[3]-n[1])/2),void 0===s&&(s=1),void 0===i&&(i=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return w.apply(R,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),d.apply(g,arguments)}},e.javascript=g,e.pathToLineSegments=o,e.webgl=R,e.webglUtils=u,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}const cr=/\bvoid\s+main\s*\(\s*\)\s*{/g;function ur(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let r=Te[t];return r?ur(r):e})}const hr=[];for(let e=0;e<256;e++)hr[e]=(e<16?"0":"")+e.toString(16);const dr=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},fr=Date.now(),pr=new WeakMap,gr=new Map;let mr=1e10;function vr(e,t){const r=function(e){const t=JSON.stringify(e,xr);let r=Sr.get(t);null==r&&Sr.set(t,r=++br);return r}
/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/(t);let n=pr.get(e);if(n||pr.set(e,n=Object.create(null)),n[r])return new n[r];const o=`_onBeforeCompile${r}`,s=function(n,s){e.onBeforeCompile.call(this,n,s);const a=this.customProgramCacheKey()+"|"+n.vertexShader+"|"+n.fragmentShader;let i=gr[a];if(!i){const e=function(e,{vertexShader:t,fragmentShader:r},n,o){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:f,timeUniform:p}=n;s=s||"",a=a||"",i=i||"",c=c||"",u=u||"",h=h||"",(l||f)&&(t=ur(t));(d||f)&&(r=ur(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(f){let e=f({vertexShader:t,fragmentShader:r});t=e.vertexShader,r=e.fragmentShader}if(d){let e=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),h=`${d}\n${e.join("\n")}\n${h}`}if(p){const e=`\nuniform float ${p};\n`;s=e+s,c=e+c}l&&(s=`${s}\nvoid troikaVertexTransform${o}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,a=`\ntroika_position_${o} = vec3(position);\ntroika_normal_${o} = vec3(normal);\ntroika_uv_${o} = vec2(uv);\ntroikaVertexTransform${o}(troika_position_${o}, troika_normal_${o}, troika_uv_${o});\n${a}\n`,t=(t=`vec3 troika_position_${o};\nvec3 troika_normal_${o};\nvec2 troika_uv_${o};\n${t}\n`).replace(/\b(position|normal|uv)\b/g,(e,t,r,n)=>/\battribute\s+vec[23]\s+$/.test(n.substr(0,r))?t:`troika_${t}_${o}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${o}`)));return t=yr(t,o,s,a,i),r=yr(r,o,c,u,h),{vertexShader:t,fragmentShader:r}}(this,n,t,r);i=gr[a]=e}n.vertexShader=i.vertexShader,n.fragmentShader=i.fragmentShader,dr(n.uniforms,this.uniforms),t.timeUniform&&(n.uniforms[t.timeUniform]={get value(){return Date.now()-fr}}),this[o]&&this[o](n)},a=function(){return i(t.chained?e:e.clone())},i=function(n){const o=Object.create(n,l);return Object.defineProperty(o,"baseMaterial",{value:e}),Object.defineProperty(o,"id",{value:mr++}),o.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(hr[255&e]+hr[e>>8&255]+hr[e>>16&255]+hr[e>>24&255]+"-"+hr[255&t]+hr[t>>8&255]+"-"+hr[t>>16&15|64]+hr[t>>24&255]+"-"+hr[63&r|128]+hr[r>>8&255]+"-"+hr[r>>16&255]+hr[r>>24&255]+hr[255&n]+hr[n>>8&255]+hr[n>>16&255]+hr[n>>24&255]).toUpperCase()}(),o.uniforms=dr({},n.uniforms,t.uniforms),o.defines=dr({},n.defines,t.defines),o.defines[`TROIKA_DERIVED_MATERIAL_${r}`]="",o.extensions=dr({},n.extensions,t.extensions),o._listeners=void 0,o},l={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>e.type,set:t=>{e.type=t}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){const t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+r}},onBeforeCompile:{get:()=>s,set(e){this[o]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(dr(this.extensions,t.extensions),dr(this.defines,t.defines),dr(this.uniforms,Se.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return i(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let r=this._depthMaterial;return r||(r=this._depthMaterial=vr(e.isDerivedMaterial?e.getDepthMaterial():new xe({depthPacking:be}),t),r.defines.IS_DEPTH_MATERIAL="",r.uniforms=this.uniforms),r}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let r=this._distanceMaterial;return r||(r=this._distanceMaterial=vr(e.isDerivedMaterial?e.getDistanceMaterial():new ye,t),r.defines.IS_DISTANCE_MATERIAL="",r.uniforms=this.uniforms),r}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}};return n[r]=a,new a}function yr(e,t,r,n,o){return(n||o||r)&&(e=e.replace(cr,`\n${r}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${n}\n  troikaOrigMain${t}();\n  ${o}\n}`),e}function xr(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let br=0;const Sr=new Map;const Tr=sr({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var r=t._bin,n=new Uint8Array(e);if("ttcf"==r.readASCII(n,0,4)){var o=4;r.readUshort(n,o),o+=2,r.readUshort(n,o),o+=2;var s=r.readUint(n,o);o+=4;for(var a=[],i=0;i<s;i++){var l=r.readUint(n,o);o+=4,a.push(t._readFont(n,l))}return a}return[t._readFont(n,0)]},_readFont:function(e,r){var n=t._bin,o=r;n.readFixed(e,r),r+=4;var s=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],i={_data:e,_offset:o},l={},c=0;c<s;c++){var u=n.readASCII(e,r,4);r+=4,n.readUint(e,r),r+=4;var h=n.readUint(e,r);r+=4;var d=n.readUint(e,r);r+=4,l[u]={offset:h,length:d}}for(c=0;c<a.length;c++){var f=a[c];l[f]&&(i[f.trim()]=t[f.trim()].parse(e,l[f].offset,l[f].length,i))}return i},_tabOffset:function(e,r,n){for(var o=t._bin,s=o.readUshort(e,n+4),a=n+12,i=0;i<s;i++){var l=o.readASCII(e,a,4);a+=4,o.readUint(e,a),a+=4;var c=o.readUint(e,a);if(a+=4,o.readUint(e,a),a+=4,l==r)return c}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,n){for(var o=[],s=0;s<n;s++)o.push(t._bin.readUshort(e,r+2*s));return o},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var n="",o=0;o<r;o++)n+=String.fromCharCode(e[t+o]);return n},readUnicode:function(e,t,r){for(var n="",o=0;o<r;o++){var s=e[t++]<<8|e[t++];n+=String.fromCharCode(s)}return n},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,n){var o=t._bin._tdec;return o&&0==r&&n==e.length?o.decode(e):t._bin.readASCII(e,r,n)},readBytes:function(e,t,r){for(var n=[],o=0;o<r;o++)n.push(e[t+o]);return n},readASCIIArray:function(e,t,r){for(var n=[],o=0;o<r;o++)n.push(String.fromCharCode(e[t+o]));return n},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,n,o,s){var a=t._bin,i={},l=r;a.readFixed(e,r),r+=4;var c=a.readUshort(e,r);r+=2;var u=a.readUshort(e,r);r+=2;var h=a.readUshort(e,r);return r+=2,i.scriptList=t._lctf.readScriptList(e,l+c),i.featureList=t._lctf.readFeatureList(e,l+u),i.lookupList=t._lctf.readLookupList(e,l+h,s),i},t._lctf.readLookupList=function(e,r,n){var o=t._bin,s=r,a=[],i=o.readUshort(e,r);r+=2;for(var l=0;l<i;l++){var c=o.readUshort(e,r);r+=2;var u=t._lctf.readLookupTable(e,s+c,n);a.push(u)}return a},t._lctf.readLookupTable=function(e,r,n){var o=t._bin,s=r,a={tabs:[]};a.ltype=o.readUshort(e,r),r+=2,a.flag=o.readUshort(e,r),r+=2;var i=o.readUshort(e,r);r+=2;for(var l=a.ltype,c=0;c<i;c++){var u=o.readUshort(e,r);r+=2;var h=n(e,l,s+u,a);a.tabs.push(h)}return a},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)e>>>r&1&&t++;return t},t._lctf.readClassDef=function(e,r){var n=t._bin,o=[],s=n.readUshort(e,r);if(r+=2,1==s){var a=n.readUshort(e,r);r+=2;var i=n.readUshort(e,r);r+=2;for(var l=0;l<i;l++)o.push(a+l),o.push(a+l),o.push(n.readUshort(e,r)),r+=2}if(2==s){var c=n.readUshort(e,r);for(r+=2,l=0;l<c;l++)o.push(n.readUshort(e,r)),r+=2,o.push(n.readUshort(e,r)),r+=2,o.push(n.readUshort(e,r)),r+=2}return o},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var n=e[r],o=e[r+1];if(e[r+2],n<=t&&t<=o)return r}return-1},t._lctf.readCoverage=function(e,r){var n=t._bin,o={};o.fmt=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);return r+=2,1==o.fmt&&(o.tab=n.readUshorts(e,r,s)),2==o.fmt&&(o.tab=n.readUshorts(e,r,3*s)),o},t._lctf.coverageIndex=function(e,r){var n=e.tab;if(1==e.fmt)return n.indexOf(r);if(2==e.fmt){var o=t._lctf.getInterval(n,r);if(-1!=o)return n[o+2]+(r-n[o])}return-1},t._lctf.readFeatureList=function(e,r){var n=t._bin,o=r,s=[],a=n.readUshort(e,r);r+=2;for(var i=0;i<a;i++){var l=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2;var u=t._lctf.readFeatureTable(e,o+c);u.tag=l.trim(),s.push(u)}return s},t._lctf.readFeatureTable=function(e,r){var n=t._bin,o=r,s={},a=n.readUshort(e,r);r+=2,a>0&&(s.featureParams=o+a);var i=n.readUshort(e,r);r+=2,s.tab=[];for(var l=0;l<i;l++)s.tab.push(n.readUshort(e,r+2*l));return s},t._lctf.readScriptList=function(e,r){var n=t._bin,o=r,s={},a=n.readUshort(e,r);r+=2;for(var i=0;i<a;i++){var l=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2,s[l.trim()]=t._lctf.readScriptTable(e,o+c)}return s},t._lctf.readScriptTable=function(e,r){var n=t._bin,o=r,s={},a=n.readUshort(e,r);r+=2,a>0&&(s.default=t._lctf.readLangSysTable(e,o+a));var i=n.readUshort(e,r);r+=2;for(var l=0;l<i;l++){var c=n.readASCII(e,r,4);r+=4;var u=n.readUshort(e,r);r+=2,s[c.trim()]=t._lctf.readLangSysTable(e,o+u)}return s},t._lctf.readLangSysTable=function(e,r){var n=t._bin,o={};n.readUshort(e,r),r+=2,o.reqFeature=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);return r+=2,o.features=n.readUshorts(e,r,s),o},t.CFF={},t.CFF.parse=function(e,r,n){var o=t._bin;(e=new Uint8Array(e.buffer,r,n))[r=0],e[++r],e[++r],e[++r],r++;var s=[];r=t.CFF.readIndex(e,r,s);for(var a=[],i=0;i<s.length-1;i++)a.push(o.readASCII(e,r+s[i],s[i+1]-s[i]));r+=s[s.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var c=[];for(i=0;i<l.length-1;i++)c.push(t.CFF.readDict(e,r+l[i],r+l[i+1]));r+=l[l.length-1];var u=c[0],h=[];r=t.CFF.readIndex(e,r,h);var d=[];for(i=0;i<h.length-1;i++)d.push(o.readASCII(e,r+h[i],h[i+1]-h[i]));if(r+=h[h.length-1],t.CFF.readSubrs(e,r,u),u.CharStrings){r=u.CharStrings,h=[],r=t.CFF.readIndex(e,r,h);var f=[];for(i=0;i<h.length-1;i++)f.push(o.readBytes(e,r+h[i],h[i+1]-h[i]));u.CharStrings=f}if(u.ROS){r=u.FDArray;var p=[];for(r=t.CFF.readIndex(e,r,p),u.FDArray=[],i=0;i<p.length-1;i++){var g=t.CFF.readDict(e,r+p[i],r+p[i+1]);t.CFF._readFDict(e,g,d),u.FDArray.push(g)}r+=p[p.length-1],r=u.FDSelect,u.FDSelect=[];var m=e[r];if(r++,3!=m)throw m;var v=o.readUshort(e,r);for(r+=2,i=0;i<v+1;i++)u.FDSelect.push(o.readUshort(e,r),e[r+2]),r+=3}return u.Encoding&&(u.Encoding=t.CFF.readEncoding(e,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=t.CFF.readCharset(e,u.charset,u.CharStrings.length)),t.CFF._readFDict(e,u,d),u},t.CFF._readFDict=function(e,r,n){var o;for(var s in r.Private&&(o=r.Private[1],r.Private=t.CFF.readDict(e,o,o+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,o+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(s)&&(r[s]=n[r[s]-426+35])},t.CFF.readSubrs=function(e,r,n){var o=t._bin,s=[];r=t.CFF.readIndex(e,r,s);var a,i=s.length;a=i<1240?107:i<33900?1131:32768,n.Bias=a,n.Subrs=[];for(var l=0;l<s.length-1;l++)n.Subrs.push(o.readBytes(e,r+s[l],s[l+1]-s[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return-1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,n){t._bin;var o=[".notdef"],s=e[r];if(r++,0!=s)throw"error: unknown encoding format: "+s;var a=e[r];r++;for(var i=0;i<a;i++)o.push(e[r+i]);return o},t.CFF.readCharset=function(e,r,n){var o=t._bin,s=[".notdef"],a=e[r];if(r++,0==a)for(var i=0;i<n;i++){var l=o.readUshort(e,r);r+=2,s.push(l)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;s.length<n;){l=o.readUshort(e,r),r+=2;var c=0;for(1==a?(c=e[r],r++):(c=o.readUshort(e,r),r+=2),i=0;i<=c;i++)s.push(l),l++}}return s},t.CFF.readIndex=function(e,r,n){var o=t._bin,s=o.readUshort(e,r)+1,a=e[r+=2];if(r++,1==a)for(var i=0;i<s;i++)n.push(e[r+i]);else if(2==a)for(i=0;i<s;i++)n.push(o.readUshort(e,r+2*i));else if(3==a)for(i=0;i<s;i++)n.push(16777215&o.readUint(e,r+3*i-1));else if(1!=s)throw"unsupported offset size: "+a+", count: "+s;return(r+=s*a)-1},t.CFF.getCharString=function(e,r,n){var o=t._bin,s=e[r],a=e[r+1];e[r+2],e[r+3],e[r+4];var i=1,l=null,c=null;s<=20&&(l=s,i=1),12==s&&(l=100*s+a,i=2),21<=s&&s<=27&&(l=s,i=1),28==s&&(c=o.readShort(e,r+1),i=3),29<=s&&s<=31&&(l=s,i=1),32<=s&&s<=246&&(c=s-139,i=1),247<=s&&s<=250&&(c=256*(s-247)+a+108,i=2),251<=s&&s<=254&&(c=256*-(s-251)-a-108,i=2),255==s&&(c=o.readInt(e,r+1)/65535,i=5),n.val=null!=c?c:"o"+l,n.size=i},t.CFF.readCharString=function(e,r,n){for(var o=r+n,s=t._bin,a=[];r<o;){var i=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,u=null,h=null;i<=20&&(u=i,c=1),12==i&&(u=100*i+l,c=2),19!=i&&20!=i||(u=i,c=2),21<=i&&i<=27&&(u=i,c=1),28==i&&(h=s.readShort(e,r+1),c=3),29<=i&&i<=31&&(u=i,c=1),32<=i&&i<=246&&(h=i-139,c=1),247<=i&&i<=250&&(h=256*(i-247)+l+108,c=2),251<=i&&i<=254&&(h=256*-(i-251)-l-108,c=2),255==i&&(h=s.readInt(e,r+1)/65535,c=5),a.push(null!=h?h:"o"+u),r+=c}return a},t.CFF.readDict=function(e,r,n){for(var o=t._bin,s={},a=[];r<n;){var i=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,u=null,h=null;if(28==i&&(h=o.readShort(e,r+1),c=3),29==i&&(h=o.readInt(e,r+1),c=5),32<=i&&i<=246&&(h=i-139,c=1),247<=i&&i<=250&&(h=256*(i-247)+l+108,c=2),251<=i&&i<=254&&(h=256*-(i-251)-l-108,c=2),255==i)throw h=o.readInt(e,r+1)/65535,c=5,"unknown number";if(30==i){var d=[];for(c=1;;){var f=e[r+c];c++;var p=f>>4,g=15&f;if(15!=p&&d.push(p),15!=g&&d.push(g),15==g)break}for(var m="",v=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<d.length;y++)m+=v[d[y]];h=parseFloat(m)}i<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][i],c=1,12==i&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(s[u]=1==a.length?a[0]:a,a=[]):a.push(h),r+=c}return s},t.cmap={},t.cmap.parse=function(e,r,n){e=new Uint8Array(e.buffer,r,n),r=0;var o=t._bin,s={};o.readUshort(e,r),r+=2;var a=o.readUshort(e,r);r+=2;var i=[];s.tables=[];for(var l=0;l<a;l++){var c=o.readUshort(e,r);r+=2;var u=o.readUshort(e,r);r+=2;var h=o.readUint(e,r);r+=4;var d="p"+c+"e"+u,f=i.indexOf(h);if(-1==f){var p;f=s.tables.length,i.push(h);var g=o.readUshort(e,h);0==g?p=t.cmap.parse0(e,h):4==g?p=t.cmap.parse4(e,h):6==g?p=t.cmap.parse6(e,h):12==g?p=t.cmap.parse12(e,h):console.debug("unknown format: "+g,c,u,h),s.tables.push(p)}if(null!=s[d])throw"multiple tables for one platform+encoding";s[d]=f}return s},t.cmap.parse0=function(e,r){var n=t._bin,o={};o.format=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,o.map=[];for(var a=0;a<s-6;a++)o.map.push(e[r+a]);return o},t.cmap.parse4=function(e,r){var n=t._bin,o=r,s={};s.format=n.readUshort(e,r),r+=2;var a=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2;var l=i/2;s.searchRange=n.readUshort(e,r),r+=2,s.entrySelector=n.readUshort(e,r),r+=2,s.rangeShift=n.readUshort(e,r),r+=2,s.endCount=n.readUshorts(e,r,l),r+=2*l,r+=2,s.startCount=n.readUshorts(e,r,l),r+=2*l,s.idDelta=[];for(var c=0;c<l;c++)s.idDelta.push(n.readShort(e,r)),r+=2;for(s.idRangeOffset=n.readUshorts(e,r,l),r+=2*l,s.glyphIdArray=[];r<o+a;)s.glyphIdArray.push(n.readUshort(e,r)),r+=2;return s},t.cmap.parse6=function(e,r){var n=t._bin,o={};o.format=n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,o.firstCode=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2,o.glyphIdArray=[];for(var a=0;a<s;a++)o.glyphIdArray.push(n.readUshort(e,r)),r+=2;return o},t.cmap.parse12=function(e,r){var n=t._bin,o={};o.format=n.readUshort(e,r),r+=2,r+=2,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4;var s=n.readUint(e,r);r+=4,o.groups=[];for(var a=0;a<s;a++){var i=r+12*a,l=n.readUint(e,i+0),c=n.readUint(e,i+4),u=n.readUint(e,i+8);o.groups.push([l,c,u])}return o},t.glyf={},t.glyf.parse=function(e,t,r,n){for(var o=[],s=0;s<n.maxp.numGlyphs;s++)o.push(null);return o},t.glyf._parseGlyf=function(e,r){var n=t._bin,o=e._data,s=t._tabOffset(o,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var a={};if(a.noc=n.readShort(o,s),s+=2,a.xMin=n.readShort(o,s),s+=2,a.yMin=n.readShort(o,s),s+=2,a.xMax=n.readShort(o,s),s+=2,a.yMax=n.readShort(o,s),s+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var i=0;i<a.noc;i++)a.endPts.push(n.readUshort(o,s)),s+=2;var l=n.readUshort(o,s);if(s+=2,o.length-s<l)return null;a.instructions=n.readBytes(o,s,l),s+=l;var c=a.endPts[a.noc-1]+1;for(a.flags=[],i=0;i<c;i++){var u=o[s];if(s++,a.flags.push(u),8&u){var h=o[s];s++;for(var d=0;d<h;d++)a.flags.push(u),i++}}for(a.xs=[],i=0;i<c;i++){var f=!!(2&a.flags[i]),p=!!(16&a.flags[i]);f?(a.xs.push(p?o[s]:-o[s]),s++):p?a.xs.push(0):(a.xs.push(n.readShort(o,s)),s+=2)}for(a.ys=[],i=0;i<c;i++)f=!!(4&a.flags[i]),p=!!(32&a.flags[i]),f?(a.ys.push(p?o[s]:-o[s]),s++):p?a.ys.push(0):(a.ys.push(n.readShort(o,s)),s+=2);var g=0,m=0;for(i=0;i<c;i++)g+=a.xs[i],m+=a.ys[i],a.xs[i]=g,a.ys[i]=m}else{var v;a.parts=[];do{v=n.readUshort(o,s),s+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(y),y.glyphIndex=n.readUshort(o,s),s+=2,1&v){var x=n.readShort(o,s);s+=2;var b=n.readShort(o,s);s+=2}else x=n.readInt8(o,s),s++,b=n.readInt8(o,s),s++;2&v?(y.m.tx=x,y.m.ty=b):(y.p1=x,y.p2=b),8&v?(y.m.a=y.m.d=n.readF2dot14(o,s),s+=2):64&v?(y.m.a=n.readF2dot14(o,s),s+=2,y.m.d=n.readF2dot14(o,s),s+=2):128&v&&(y.m.a=n.readF2dot14(o,s),s+=2,y.m.b=n.readF2dot14(o,s),s+=2,y.m.c=n.readF2dot14(o,s),s+=2,y.m.d=n.readF2dot14(o,s),s+=2)}while(32&v);if(256&v){var S=n.readUshort(o,s);for(s+=2,a.instr=[],i=0;i<S;i++)a.instr.push(o[s]),s++}}return a},t.GDEF={},t.GDEF.parse=function(e,r,n,o){var s=r;r+=4;var a=t._bin.readUshort(e,r);return{glyphClassDef:0===a?null:t._lctf.readClassDef(e,s+a)}},t.GPOS={},t.GPOS.parse=function(e,r,n,o){return t._lctf.parse(e,r,n,o,t.GPOS.subt)},t.GPOS.subt=function(e,r,n,o){var s=t._bin,a=n,i={};if(i.fmt=s.readUshort(e,n),n+=2,1==r||2==r||3==r||7==r||8==r&&i.fmt<=2){var l=s.readUshort(e,n);n+=2,i.coverage=t._lctf.readCoverage(e,l+a)}if(1==r&&1==i.fmt){var c=s.readUshort(e,n);n+=2,0!=c&&(i.pos=t.GPOS.readValueRecord(e,n,c))}else if(2==r&&i.fmt>=1&&i.fmt<=2){c=s.readUshort(e,n),n+=2;var u=s.readUshort(e,n);n+=2;var h=t._lctf.numOfOnes(c),d=t._lctf.numOfOnes(u);if(1==i.fmt){i.pairsets=[];var f=s.readUshort(e,n);n+=2;for(var p=0;p<f;p++){var g=a+s.readUshort(e,n);n+=2;var m=s.readUshort(e,g);g+=2;for(var v=[],y=0;y<m;y++){var x=s.readUshort(e,g);g+=2,0!=c&&(_=t.GPOS.readValueRecord(e,g,c),g+=2*h),0!=u&&(R=t.GPOS.readValueRecord(e,g,u),g+=2*d),v.push({gid2:x,val1:_,val2:R})}i.pairsets.push(v)}}if(2==i.fmt){var b=s.readUshort(e,n);n+=2;var S=s.readUshort(e,n);n+=2;var T=s.readUshort(e,n);n+=2;var w=s.readUshort(e,n);for(n+=2,i.classDef1=t._lctf.readClassDef(e,a+b),i.classDef2=t._lctf.readClassDef(e,a+S),i.matrix=[],p=0;p<T;p++){var A=[];for(y=0;y<w;y++){var _=null,R=null;0!=c&&(_=t.GPOS.readValueRecord(e,n,c),n+=2*h),0!=u&&(R=t.GPOS.readValueRecord(e,n,u),n+=2*d),A.push({val1:_,val2:R})}i.matrix.push(A)}}}else if(4==r&&1==i.fmt)i.markCoverage=t._lctf.readCoverage(e,s.readUshort(e,n)+a),i.baseCoverage=t._lctf.readCoverage(e,s.readUshort(e,n+2)+a),i.markClassCount=s.readUshort(e,n+4),i.markArray=t.GPOS.readMarkArray(e,s.readUshort(e,n+6)+a),i.baseArray=t.GPOS.readBaseArray(e,s.readUshort(e,n+8)+a,i.markClassCount);else if(6==r&&1==i.fmt)i.mark1Coverage=t._lctf.readCoverage(e,s.readUshort(e,n)+a),i.mark2Coverage=t._lctf.readCoverage(e,s.readUshort(e,n+2)+a),i.markClassCount=s.readUshort(e,n+4),i.mark1Array=t.GPOS.readMarkArray(e,s.readUshort(e,n+6)+a),i.mark2Array=t.GPOS.readBaseArray(e,s.readUshort(e,n+8)+a,i.markClassCount);else{if(9==r&&1==i.fmt){var U=s.readUshort(e,n);n+=2;var C=s.readUint(e,n);if(n+=4,9==o.ltype)o.ltype=U;else if(o.ltype!=U)throw"invalid extension substitution";return t.GPOS.subt(e,o.ltype,a+C)}console.debug("unsupported GPOS table LookupType",r,"format",i.fmt)}return i},t.GPOS.readValueRecord=function(e,r,n){var o=t._bin,s=[];return s.push(1&n?o.readShort(e,r):0),r+=1&n?2:0,s.push(2&n?o.readShort(e,r):0),r+=2&n?2:0,s.push(4&n?o.readShort(e,r):0),r+=4&n?2:0,s.push(8&n?o.readShort(e,r):0),r+=8&n?2:0,s},t.GPOS.readBaseArray=function(e,r,n){var o=t._bin,s=[],a=r,i=o.readUshort(e,r);r+=2;for(var l=0;l<i;l++){for(var c=[],u=0;u<n;u++)c.push(t.GPOS.readAnchorRecord(e,a+o.readUshort(e,r))),r+=2;s.push(c)}return s},t.GPOS.readMarkArray=function(e,r){var n=t._bin,o=[],s=r,a=n.readUshort(e,r);r+=2;for(var i=0;i<a;i++){var l=t.GPOS.readAnchorRecord(e,n.readUshort(e,r+2)+s);l.markClass=n.readUshort(e,r),o.push(l),r+=4}return o},t.GPOS.readAnchorRecord=function(e,r){var n=t._bin,o={};return o.fmt=n.readUshort(e,r),o.x=n.readShort(e,r+2),o.y=n.readShort(e,r+4),o},t.GSUB={},t.GSUB.parse=function(e,r,n,o){return t._lctf.parse(e,r,n,o,t.GSUB.subt)},t.GSUB.subt=function(e,r,n,o){var s=t._bin,a=n,i={};if(i.fmt=s.readUshort(e,n),n+=2,1!=r&&2!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||2==r||4==r||5==r&&i.fmt<=2||6==r&&i.fmt<=2){var l=s.readUshort(e,n);n+=2,i.coverage=t._lctf.readCoverage(e,a+l)}if(1==r&&i.fmt>=1&&i.fmt<=2){if(1==i.fmt)i.delta=s.readShort(e,n),n+=2;else if(2==i.fmt){var c=s.readUshort(e,n);n+=2,i.newg=s.readUshorts(e,n,c),n+=2*i.newg.length}}else if(2==r&&1==i.fmt){c=s.readUshort(e,n),n+=2,i.seqs=[];for(var u=0;u<c;u++){var h=s.readUshort(e,n)+a;n+=2;var d=s.readUshort(e,h);i.seqs.push(s.readUshorts(e,h+2,d))}}else if(4==r)for(i.vals=[],c=s.readUshort(e,n),n+=2,u=0;u<c;u++){var f=s.readUshort(e,n);n+=2,i.vals.push(t.GSUB.readLigatureSet(e,a+f))}else if(5==r&&2==i.fmt){if(2==i.fmt){var p=s.readUshort(e,n);n+=2,i.cDef=t._lctf.readClassDef(e,a+p),i.scset=[];var g=s.readUshort(e,n);for(n+=2,u=0;u<g;u++){var m=s.readUshort(e,n);n+=2,i.scset.push(0==m?null:t.GSUB.readSubClassSet(e,a+m))}}}else if(6==r&&3==i.fmt){if(3==i.fmt){for(u=0;u<3;u++){c=s.readUshort(e,n),n+=2;for(var v=[],y=0;y<c;y++)v.push(t._lctf.readCoverage(e,a+s.readUshort(e,n+2*y)));n+=2*c,0==u&&(i.backCvg=v),1==u&&(i.inptCvg=v),2==u&&(i.ahedCvg=v)}c=s.readUshort(e,n),n+=2,i.lookupRec=t.GSUB.readSubstLookupRecords(e,n,c)}}else{if(7==r&&1==i.fmt){var x=s.readUshort(e,n);n+=2;var b=s.readUint(e,n);if(n+=4,9==o.ltype)o.ltype=x;else if(o.ltype!=x)throw"invalid extension substitution";return t.GSUB.subt(e,o.ltype,a+b)}console.debug("unsupported GSUB table LookupType",r,"format",i.fmt)}return i},t.GSUB.readSubClassSet=function(e,r){var n=t._bin.readUshort,o=r,s=[],a=n(e,r);r+=2;for(var i=0;i<a;i++){var l=n(e,r);r+=2,s.push(t.GSUB.readSubClassRule(e,o+l))}return s},t.GSUB.readSubClassRule=function(e,r){var n=t._bin.readUshort,o={},s=n(e,r),a=n(e,r+=2);r+=2,o.input=[];for(var i=0;i<s-1;i++)o.input.push(n(e,r)),r+=2;return o.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,a),o},t.GSUB.readSubstLookupRecords=function(e,r,n){for(var o=t._bin.readUshort,s=[],a=0;a<n;a++)s.push(o(e,r),o(e,r+2)),r+=4;return s},t.GSUB.readChainSubClassSet=function(e,r){var n=t._bin,o=r,s=[],a=n.readUshort(e,r);r+=2;for(var i=0;i<a;i++){var l=n.readUshort(e,r);r+=2,s.push(t.GSUB.readChainSubClassRule(e,o+l))}return s},t.GSUB.readChainSubClassRule=function(e,r){for(var n=t._bin,o={},s=["backtrack","input","lookahead"],a=0;a<s.length;a++){var i=n.readUshort(e,r);r+=2,1==a&&i--,o[s[a]]=n.readUshorts(e,r,i),r+=2*o[s[a]].length}return i=n.readUshort(e,r),r+=2,o.subst=n.readUshorts(e,r,2*i),r+=2*o.subst.length,o},t.GSUB.readLigatureSet=function(e,r){var n=t._bin,o=r,s=[],a=n.readUshort(e,r);r+=2;for(var i=0;i<a;i++){var l=n.readUshort(e,r);r+=2,s.push(t.GSUB.readLigature(e,o+l))}return s},t.GSUB.readLigature=function(e,r){var n=t._bin,o={chain:[]};o.nglyph=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;for(var a=0;a<s-1;a++)o.chain.push(n.readUshort(e,r)),r+=2;return o},t.head={},t.head.parse=function(e,r,n){var o=t._bin,s={};return o.readFixed(e,r),r+=4,s.fontRevision=o.readFixed(e,r),r+=4,o.readUint(e,r),r+=4,o.readUint(e,r),r+=4,s.flags=o.readUshort(e,r),r+=2,s.unitsPerEm=o.readUshort(e,r),r+=2,s.created=o.readUint64(e,r),r+=8,s.modified=o.readUint64(e,r),r+=8,s.xMin=o.readShort(e,r),r+=2,s.yMin=o.readShort(e,r),r+=2,s.xMax=o.readShort(e,r),r+=2,s.yMax=o.readShort(e,r),r+=2,s.macStyle=o.readUshort(e,r),r+=2,s.lowestRecPPEM=o.readUshort(e,r),r+=2,s.fontDirectionHint=o.readShort(e,r),r+=2,s.indexToLocFormat=o.readShort(e,r),r+=2,s.glyphDataFormat=o.readShort(e,r),r+=2,s},t.hhea={},t.hhea.parse=function(e,r,n){var o=t._bin,s={};return o.readFixed(e,r),r+=4,s.ascender=o.readShort(e,r),r+=2,s.descender=o.readShort(e,r),r+=2,s.lineGap=o.readShort(e,r),r+=2,s.advanceWidthMax=o.readUshort(e,r),r+=2,s.minLeftSideBearing=o.readShort(e,r),r+=2,s.minRightSideBearing=o.readShort(e,r),r+=2,s.xMaxExtent=o.readShort(e,r),r+=2,s.caretSlopeRise=o.readShort(e,r),r+=2,s.caretSlopeRun=o.readShort(e,r),r+=2,s.caretOffset=o.readShort(e,r),r+=2,r+=8,s.metricDataFormat=o.readShort(e,r),r+=2,s.numberOfHMetrics=o.readUshort(e,r),r+=2,s},t.hmtx={},t.hmtx.parse=function(e,r,n,o){for(var s=t._bin,a={aWidth:[],lsBearing:[]},i=0,l=0,c=0;c<o.maxp.numGlyphs;c++)c<o.hhea.numberOfHMetrics&&(i=s.readUshort(e,r),r+=2,l=s.readShort(e,r),r+=2),a.aWidth.push(i),a.lsBearing.push(l);return a},t.kern={},t.kern.parse=function(e,r,n,o){var s=t._bin,a=s.readUshort(e,r);if(r+=2,1==a)return t.kern.parseV1(e,r-2,n,o);var i=s.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},c=0;c<i;c++){r+=2,n=s.readUshort(e,r),r+=2;var u=s.readUshort(e,r);r+=2;var h=u>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,n,o){var s=t._bin;s.readFixed(e,r),r+=4;var a=s.readUint(e,r);r+=4;for(var i={glyph1:[],rval:[]},l=0;l<a;l++){s.readUint(e,r),r+=4;var c=s.readUshort(e,r);r+=2,s.readUshort(e,r),r+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;r=t.kern.readFormat0(e,r,i)}return i},t.kern.readFormat0=function(e,r,n){var o=t._bin,s=-1,a=o.readUshort(e,r);r+=2,o.readUshort(e,r),r+=2,o.readUshort(e,r),r+=2,o.readUshort(e,r),r+=2;for(var i=0;i<a;i++){var l=o.readUshort(e,r);r+=2;var c=o.readUshort(e,r);r+=2;var u=o.readShort(e,r);r+=2,l!=s&&(n.glyph1.push(l),n.rval.push({glyph2:[],vals:[]}));var h=n.rval[n.rval.length-1];h.glyph2.push(c),h.vals.push(u),s=l}return r},t.loca={},t.loca.parse=function(e,r,n,o){var s=t._bin,a=[],i=o.head.indexToLocFormat,l=o.maxp.numGlyphs+1;if(0==i)for(var c=0;c<l;c++)a.push(s.readUshort(e,r+(c<<1))<<1);if(1==i)for(c=0;c<l;c++)a.push(s.readUint(e,r+(c<<2)));return a},t.maxp={},t.maxp.parse=function(e,r,n){var o=t._bin,s={},a=o.readUint(e,r);return r+=4,s.numGlyphs=o.readUshort(e,r),r+=2,65536==a&&(s.maxPoints=o.readUshort(e,r),r+=2,s.maxContours=o.readUshort(e,r),r+=2,s.maxCompositePoints=o.readUshort(e,r),r+=2,s.maxCompositeContours=o.readUshort(e,r),r+=2,s.maxZones=o.readUshort(e,r),r+=2,s.maxTwilightPoints=o.readUshort(e,r),r+=2,s.maxStorage=o.readUshort(e,r),r+=2,s.maxFunctionDefs=o.readUshort(e,r),r+=2,s.maxInstructionDefs=o.readUshort(e,r),r+=2,s.maxStackElements=o.readUshort(e,r),r+=2,s.maxSizeOfInstructions=o.readUshort(e,r),r+=2,s.maxComponentElements=o.readUshort(e,r),r+=2,s.maxComponentDepth=o.readUshort(e,r),r+=2),s},t.name={},t.name.parse=function(e,r,n){var o=t._bin,s={};o.readUshort(e,r),r+=2;var a=o.readUshort(e,r);r+=2,o.readUshort(e,r);for(var i,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=r+=2,u=0;u<a;u++){var h=o.readUshort(e,r);r+=2;var d=o.readUshort(e,r);r+=2;var f=o.readUshort(e,r);r+=2;var p=o.readUshort(e,r);r+=2;var g=o.readUshort(e,r);r+=2;var m=o.readUshort(e,r);r+=2;var v,y=l[p],x=c+12*a+m;if(0==h)v=o.readUnicode(e,x,g/2);else if(3==h&&0==d)v=o.readUnicode(e,x,g/2);else if(0==d)v=o.readASCII(e,x,g);else if(1==d)v=o.readUnicode(e,x,g/2);else if(3==d)v=o.readUnicode(e,x,g/2);else{if(1!=h)throw"unknown encoding "+d+", platformID: "+h;v=o.readASCII(e,x,g),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var b="p"+h+","+f.toString(16);null==s[b]&&(s[b]={}),s[b][void 0!==y?y:p]=v,s[b]._lang=f}for(var S in s)if(null!=s[S].postScriptName&&1033==s[S]._lang)return s[S];for(var S in s)if(null!=s[S].postScriptName&&0==s[S]._lang)return s[S];for(var S in s)if(null!=s[S].postScriptName&&3084==s[S]._lang)return s[S];for(var S in s)if(null!=s[S].postScriptName)return s[S];for(var S in s){i=S;break}return console.debug("returning name table with languageID "+s[i]._lang),s[i]},t["OS/2"]={},t["OS/2"].parse=function(e,r,n){var o=t._bin.readUshort(e,r);r+=2;var s={};if(0==o)t["OS/2"].version0(e,r,s);else if(1==o)t["OS/2"].version1(e,r,s);else if(2==o||3==o||4==o)t["OS/2"].version2(e,r,s);else{if(5!=o)throw"unknown OS/2 table version: "+o;t["OS/2"].version5(e,r,s)}return s},t["OS/2"].version0=function(e,r,n){var o=t._bin;return n.xAvgCharWidth=o.readShort(e,r),r+=2,n.usWeightClass=o.readUshort(e,r),r+=2,n.usWidthClass=o.readUshort(e,r),r+=2,n.fsType=o.readUshort(e,r),r+=2,n.ySubscriptXSize=o.readShort(e,r),r+=2,n.ySubscriptYSize=o.readShort(e,r),r+=2,n.ySubscriptXOffset=o.readShort(e,r),r+=2,n.ySubscriptYOffset=o.readShort(e,r),r+=2,n.ySuperscriptXSize=o.readShort(e,r),r+=2,n.ySuperscriptYSize=o.readShort(e,r),r+=2,n.ySuperscriptXOffset=o.readShort(e,r),r+=2,n.ySuperscriptYOffset=o.readShort(e,r),r+=2,n.yStrikeoutSize=o.readShort(e,r),r+=2,n.yStrikeoutPosition=o.readShort(e,r),r+=2,n.sFamilyClass=o.readShort(e,r),r+=2,n.panose=o.readBytes(e,r,10),r+=10,n.ulUnicodeRange1=o.readUint(e,r),r+=4,n.ulUnicodeRange2=o.readUint(e,r),r+=4,n.ulUnicodeRange3=o.readUint(e,r),r+=4,n.ulUnicodeRange4=o.readUint(e,r),r+=4,n.achVendID=[o.readInt8(e,r),o.readInt8(e,r+1),o.readInt8(e,r+2),o.readInt8(e,r+3)],r+=4,n.fsSelection=o.readUshort(e,r),r+=2,n.usFirstCharIndex=o.readUshort(e,r),r+=2,n.usLastCharIndex=o.readUshort(e,r),r+=2,n.sTypoAscender=o.readShort(e,r),r+=2,n.sTypoDescender=o.readShort(e,r),r+=2,n.sTypoLineGap=o.readShort(e,r),r+=2,n.usWinAscent=o.readUshort(e,r),r+=2,n.usWinDescent=o.readUshort(e,r),r+2},t["OS/2"].version1=function(e,r,n){var o=t._bin;return r=t["OS/2"].version0(e,r,n),n.ulCodePageRange1=o.readUint(e,r),r+=4,n.ulCodePageRange2=o.readUint(e,r),r+4},t["OS/2"].version2=function(e,r,n){var o=t._bin;return r=t["OS/2"].version1(e,r,n),n.sxHeight=o.readShort(e,r),r+=2,n.sCapHeight=o.readShort(e,r),r+=2,n.usDefault=o.readUshort(e,r),r+=2,n.usBreak=o.readUshort(e,r),r+=2,n.usMaxContext=o.readUshort(e,r),r+2},t["OS/2"].version5=function(e,r,n){var o=t._bin;return r=t["OS/2"].version2(e,r,n),n.usLowerOpticalPointSize=o.readUshort(e,r),r+=2,n.usUpperOpticalPointSize=o.readUshort(e,r),r+2},t.post={},t.post.parse=function(e,r,n){var o=t._bin,s={};return s.version=o.readFixed(e,r),r+=4,s.italicAngle=o.readFixed(e,r),r+=4,s.underlinePosition=o.readShort(e,r),r+=2,s.underlineThickness=o.readShort(e,r),r+=2,s},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,n=-1;if(null!=r.p0e4?n=r.p0e4:null!=r.p3e1?n=r.p3e1:null!=r.p1e0?n=r.p1e0:null!=r.p0e3&&(n=r.p0e3),-1==n)throw"no familiar platform and encoding!";var o=r.tables[n];if(0==o.format)return t>=o.map.length?0:o.map[t];if(4==o.format){for(var s=-1,a=0;a<o.endCount.length;a++)if(t<=o.endCount[a]){s=a;break}return-1==s||o.startCount[s]>t?0:65535&(0!=o.idRangeOffset[s]?o.glyphIdArray[t-o.startCount[s]+(o.idRangeOffset[s]>>1)-(o.idRangeOffset.length-s)]:t+o.idDelta[s])}if(12==o.format){if(t>o.groups[o.groups.length-1][1])return 0;for(a=0;a<o.groups.length;a++){var i=o.groups[a];if(i[0]<=t&&t<=i[1])return i[2]+(t-i[0])}return 0}throw"unknown cmap table format "+o.format},t.U.glyphToPath=function(e,r){var n={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var o=e.SVG.entries[r];return null==o?n:("string"==typeof o&&(o=t.SVG.toPath(o),e.SVG.entries[r]=o),o)}if(e.CFF){var s={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},a=e.CFF,i=e.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=r;)l+=2;i=a.FDArray[a.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],s,a,i,n)}else e.glyf&&t.U._drawGlyf(r,e,n);return n},t.U._drawGlyf=function(e,r,n){var o=r.glyf[e];null==o&&(o=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=o&&(o.noc>-1?t.U._simpleGlyph(o,n):t.U._compoGlyph(o,r,n))},t.U._simpleGlyph=function(e,r){for(var n=0;n<e.noc;n++){for(var o=0==n?0:e.endPts[n-1]+1,s=e.endPts[n],a=o;a<=s;a++){var i=a==o?s:a-1,l=a==s?o:a+1,c=1&e.flags[a],u=1&e.flags[i],h=1&e.flags[l],d=e.xs[a],f=e.ys[a];if(a==o)if(c){if(!u){t.U.P.moveTo(r,d,f);continue}t.U.P.moveTo(r,e.xs[i],e.ys[i])}else u?t.U.P.moveTo(r,e.xs[i],e.ys[i]):t.U.P.moveTo(r,(e.xs[i]+d)/2,(e.ys[i]+f)/2);c?u&&t.U.P.lineTo(r,d,f):h?t.U.P.qcurveTo(r,d,f,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,d,f,(d+e.xs[l])/2,(f+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,n){for(var o=0;o<e.parts.length;o++){var s={cmds:[],crds:[]},a=e.parts[o];t.U._drawGlyf(a.glyphIndex,r,s);for(var i=a.m,l=0;l<s.crds.length;l+=2){var c=s.crds[l],u=s.crds[l+1];n.crds.push(c*i.a+u*i.b+i.tx),n.crds.push(c*i.c+u*i.d+i.ty)}for(l=0;l<s.cmds.length;l++)n.cmds.push(s.cmds[l])}},t.U._getGlyphClass=function(e,r){var n=t._lctf.getInterval(r,e);return-1==n?0:r[n+2]},t.U._applySubs=function(e,r,n,o){for(var s=e.length-r-1,a=0;a<n.tabs.length;a++)if(null!=n.tabs[a]){var i,l=n.tabs[a];if(!l.coverage||-1!=(i=t._lctf.coverageIndex(l.coverage,e[r])))if(1==n.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[i];else if(4==n.ltype)for(var c=l.vals[i],u=0;u<c.length;u++){var h=c[u],d=h.chain.length;if(!(d>s)){for(var f=!0,p=0,g=0;g<d;g++){for(;-1==e[r+p+(1+g)];)p++;h.chain[g]!=e[r+p+(1+g)]&&(f=!1)}if(f){for(e[r]=h.nglyph,g=0;g<d+p;g++)e[r+g+1]=-1;break}}}else if(5==n.ltype&&2==l.fmt)for(var m=t._lctf.getInterval(l.cDef,e[r]),v=l.cDef[m+2],y=l.scset[v],x=0;x<y.length;x++){var b=y[x],S=b.input;if(!(S.length>s)){for(f=!0,g=0;g<S.length;g++){var T=t._lctf.getInterval(l.cDef,e[r+1+g]);if(-1==m&&l.cDef[T+2]!=S[g]){f=!1;break}}if(f){var w=b.substLookupRecords;for(u=0;u<w.length;u+=2)w[u],w[u+1]}}}else if(6==n.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length))continue;if(!t.U._glsCovered(e,l.inptCvg,r))continue;if(!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var A=l.lookupRec;for(x=0;x<A.length;x+=2){m=A[x];var _=o[A[x+1]];t.U._applySubs(e,r+m,_,o)}}}},t.U._glsCovered=function(e,r,n){for(var o=0;o<r.length;o++)if(-1==t._lctf.coverageIndex(r[o],e[n+o]))return!1;return!0},t.U.glyphsToPath=function(e,r,n){for(var o={cmds:[],crds:[]},s=0,a=0;a<r.length;a++){var i=r[a];if(-1!=i){for(var l=a<r.length-1&&-1!=r[a+1]?r[a+1]:0,c=t.U.glyphToPath(e,i),u=0;u<c.crds.length;u+=2)o.crds.push(c.crds[u]+s),o.crds.push(c.crds[u+1]);for(n&&o.cmds.push(n),u=0;u<c.cmds.length;u++)o.cmds.push(c.cmds[u]);n&&o.cmds.push("X"),s+=e.hmtx.aWidth[i],a<r.length-1&&(s+=t.U.getPairAdjustment(e,i,l))}}return o},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,n,o,s,a){e.cmds.push("C"),e.crds.push(t,r,n,o,s,a)},t.U.P.qcurveTo=function(e,t,r,n,o){e.cmds.push("Q"),e.crds.push(t,r,n,o)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,n,o,s){for(var a=r.stack,i=r.nStems,l=r.haveWidth,c=r.width,u=r.open,h=0,d=r.x,f=r.y,p=0,g=0,m=0,v=0,y=0,x=0,b=0,S=0,T=0,w=0,A={val:0,size:0};h<e.length;){t.CFF.getCharString(e,h,A);var _=A.val;if(h+=A.size,"o1"==_||"o18"==_)a.length%2!=0&&!l&&(c=a.shift()+o.nominalWidthX),i+=a.length>>1,a.length=0,l=!0;else if("o3"==_||"o23"==_)a.length%2!=0&&!l&&(c=a.shift()+o.nominalWidthX),i+=a.length>>1,a.length=0,l=!0;else if("o4"==_)a.length>1&&!l&&(c=a.shift()+o.nominalWidthX,l=!0),u&&t.U.P.closePath(s),f+=a.pop(),t.U.P.moveTo(s,d,f),u=!0;else if("o5"==_)for(;a.length>0;)d+=a.shift(),f+=a.shift(),t.U.P.lineTo(s,d,f);else if("o6"==_||"o7"==_)for(var R=a.length,U="o6"==_,C=0;C<R;C++){var k=a.shift();U?d+=k:f+=k,U=!U,t.U.P.lineTo(s,d,f)}else if("o8"==_||"o24"==_){R=a.length;for(var E=0;E+6<=R;)p=d+a.shift(),g=f+a.shift(),m=p+a.shift(),v=g+a.shift(),d=m+a.shift(),f=v+a.shift(),t.U.P.curveTo(s,p,g,m,v,d,f),E+=6;"o24"==_&&(d+=a.shift(),f+=a.shift(),t.U.P.lineTo(s,d,f))}else{if("o11"==_)break;if("o1234"==_||"o1235"==_||"o1236"==_||"o1237"==_)"o1234"==_&&(g=f,m=(p=d+a.shift())+a.shift(),w=v=g+a.shift(),x=v,S=f,d=(b=(y=(T=m+a.shift())+a.shift())+a.shift())+a.shift(),t.U.P.curveTo(s,p,g,m,v,T,w),t.U.P.curveTo(s,y,x,b,S,d,f)),"o1235"==_&&(p=d+a.shift(),g=f+a.shift(),m=p+a.shift(),v=g+a.shift(),T=m+a.shift(),w=v+a.shift(),y=T+a.shift(),x=w+a.shift(),b=y+a.shift(),S=x+a.shift(),d=b+a.shift(),f=S+a.shift(),a.shift(),t.U.P.curveTo(s,p,g,m,v,T,w),t.U.P.curveTo(s,y,x,b,S,d,f)),"o1236"==_&&(p=d+a.shift(),g=f+a.shift(),m=p+a.shift(),w=v=g+a.shift(),x=v,b=(y=(T=m+a.shift())+a.shift())+a.shift(),S=x+a.shift(),d=b+a.shift(),t.U.P.curveTo(s,p,g,m,v,T,w),t.U.P.curveTo(s,y,x,b,S,d,f)),"o1237"==_&&(p=d+a.shift(),g=f+a.shift(),m=p+a.shift(),v=g+a.shift(),T=m+a.shift(),w=v+a.shift(),y=T+a.shift(),x=w+a.shift(),b=y+a.shift(),S=x+a.shift(),Math.abs(b-d)>Math.abs(S-f)?d=b+a.shift():f=S+a.shift(),t.U.P.curveTo(s,p,g,m,v,T,w),t.U.P.curveTo(s,y,x,b,S,d,f));else if("o14"==_){if(a.length>0&&!l&&(c=a.shift()+n.nominalWidthX,l=!0),4==a.length){var I=a.shift(),L=a.shift(),M=a.shift(),F=a.shift(),D=t.CFF.glyphBySE(n,M),P=t.CFF.glyphBySE(n,F);t.U._drawCFF(n.CharStrings[D],r,n,o,s),r.x=I,r.y=L,t.U._drawCFF(n.CharStrings[P],r,n,o,s)}u&&(t.U.P.closePath(s),u=!1)}else if("o19"==_||"o20"==_)a.length%2!=0&&!l&&(c=a.shift()+o.nominalWidthX),i+=a.length>>1,a.length=0,l=!0,h+=i+7>>3;else if("o21"==_)a.length>2&&!l&&(c=a.shift()+o.nominalWidthX,l=!0),f+=a.pop(),d+=a.pop(),u&&t.U.P.closePath(s),t.U.P.moveTo(s,d,f),u=!0;else if("o22"==_)a.length>1&&!l&&(c=a.shift()+o.nominalWidthX,l=!0),d+=a.pop(),u&&t.U.P.closePath(s),t.U.P.moveTo(s,d,f),u=!0;else if("o25"==_){for(;a.length>6;)d+=a.shift(),f+=a.shift(),t.U.P.lineTo(s,d,f);p=d+a.shift(),g=f+a.shift(),m=p+a.shift(),v=g+a.shift(),d=m+a.shift(),f=v+a.shift(),t.U.P.curveTo(s,p,g,m,v,d,f)}else if("o26"==_)for(a.length%2&&(d+=a.shift());a.length>0;)p=d,g=f+a.shift(),d=m=p+a.shift(),f=(v=g+a.shift())+a.shift(),t.U.P.curveTo(s,p,g,m,v,d,f);else if("o27"==_)for(a.length%2&&(f+=a.shift());a.length>0;)g=f,m=(p=d+a.shift())+a.shift(),v=g+a.shift(),d=m+a.shift(),f=v,t.U.P.curveTo(s,p,g,m,v,d,f);else if("o10"==_||"o29"==_){var O="o10"==_?o:n;if(0==a.length)console.debug("error: empty stack");else{var G=a.pop(),B=O.Subrs[G+O.Bias];r.x=d,r.y=f,r.nStems=i,r.haveWidth=l,r.width=c,r.open=u,t.U._drawCFF(B,r,n,o,s),d=r.x,f=r.y,i=r.nStems,l=r.haveWidth,c=r.width,u=r.open}}else if("o30"==_||"o31"==_){var N=a.length,H=(E=0,"o31"==_);for(E+=N-(R=-3&N);E<R;)H?(g=f,m=(p=d+a.shift())+a.shift(),f=(v=g+a.shift())+a.shift(),R-E==5?(d=m+a.shift(),E++):d=m,H=!1):(p=d,g=f+a.shift(),m=p+a.shift(),v=g+a.shift(),d=m+a.shift(),R-E==5?(f=v+a.shift(),E++):f=v,H=!0),t.U.P.curveTo(s,p,g,m,v,d,f),E+=4}else{if("o"==(_+"").charAt(0))throw console.debug("Unknown operation: "+_,e),_;a.push(_)}}}r.x=d,r.y=f,r.nStems=i,r.haveWidth=l,r.width=c,r.open=u};var r=t,n={Typr:r};return e.Typr=r,e.default=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr}
/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/,function(){return function(e){var t=Uint8Array,r=Uint16Array,n=Uint32Array,o=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(e,t){for(var o=new r(31),s=0;s<31;++s)o[s]=t+=1<<e[s-1];var a=new n(o[30]);for(s=1;s<30;++s)for(var i=o[s];i<o[s+1];++i)a[i]=i-o[s]<<5|s;return[o,a]},l=i(o,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=i(s,0)[0],d=new r(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var g=function(e,t,n){for(var o=e.length,s=0,a=new r(t);s<o;++s)++a[e[s]-1];var i,l=new r(t);for(s=0;s<t;++s)l[s]=l[s-1]+a[s-1]<<1;i=new r(1<<t);var c=15-t;for(s=0;s<o;++s)if(e[s])for(var u=s<<4|e[s],h=t-e[s],f=l[e[s]-1]++<<h,p=f|(1<<h)-1;f<=p;++f)i[d[f]>>>c]=u;return i},m=new t(288);for(f=0;f<144;++f)m[f]=8;for(f=144;f<256;++f)m[f]=9;for(f=256;f<280;++f)m[f]=7;for(f=280;f<288;++f)m[f]=8;var v=new t(32);for(f=0;f<32;++f)v[f]=5;var y=g(m,9),x=g(v,5),b=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},S=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},T=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],A=function(e,t,r){var n=new Error(t||w[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,A),!r)throw n;return n},_=function(e,i,l){var u=e.length;if(!u||l&&!l.l&&u<5)return i||new t(0);var d=!i||l,f=!l||l.i;l||(l={}),i||(i=new t(3*u));var p,m=function(e){var r=i.length;if(e>r){var n=new t(Math.max(2*r,e));n.set(i),i=n}},v=l.f||0,w=l.p||0,_=l.b||0,R=l.l,U=l.d,C=l.m,k=l.n,E=8*u;do{if(!R){l.f=v=S(e,w,1);var I=S(e,w+1,3);if(w+=3,!I){var L=e[(z=((p=w)/8|0)+(7&p&&1)+4)-4]|e[z-3]<<8,M=z+L;if(M>u){f&&A(0);break}d&&m(_+L),i.set(e.subarray(z,M),_),l.b=_+=L,l.p=w=8*M;continue}if(1==I)R=y,U=x,C=9,k=5;else if(2==I){var F=S(e,w,31)+257,D=S(e,w+10,15)+4,P=F+S(e,w+5,31)+1;w+=14;for(var O=new t(P),G=new t(19),B=0;B<D;++B)G[a[B]]=S(e,w+3*B,7);w+=3*D;var N=b(G),H=(1<<N)-1,j=g(G,N);for(B=0;B<P;){var z,W=j[S(e,w,H)];if(w+=15&W,(z=W>>>4)<16)O[B++]=z;else{var V=0,X=0;for(16==z?(X=3+S(e,w,3),w+=2,V=O[B-1]):17==z?(X=3+S(e,w,7),w+=3):18==z&&(X=11+S(e,w,127),w+=7);X--;)O[B++]=V}}var q=O.subarray(0,F),$=O.subarray(F);C=b(q),k=b($),R=g(q,C),U=g($,k)}else A(1);if(w>E){f&&A(0);break}}d&&m(_+131072);for(var K=(1<<C)-1,Y=(1<<k)-1,Q=w;;Q=w){var Z=(V=R[T(e,w)&K])>>>4;if((w+=15&V)>E){f&&A(0);break}if(V||A(2),Z<256)i[_++]=Z;else{if(256==Z){Q=w,R=null;break}var J=Z-254;if(Z>264){var ee=o[B=Z-257];J=S(e,w,(1<<ee)-1)+c[B],w+=ee}var te=U[T(e,w)&Y],re=te>>>4;if(te||A(3),w+=15&te,$=h[re],re>3&&(ee=s[re],$+=T(e,w)&(1<<ee)-1,w+=ee),w>E){f&&A(0);break}d&&m(_+131072);for(var ne=_+J;_<ne;_+=4)i[_]=i[_-$],i[_+1]=i[_+1-$],i[_+2]=i[_+2-$],i[_+3]=i[_+3-$];_=ne}}l.l=R,l.p=Q,l.b=_,R&&(v=1,l.m=C,l.d=U,l.n=k)}while(!v);return _==i.length?i:function(e,o,s){(null==s||s>e.length)&&(s=e.length);var a=new(e instanceof r?r:e instanceof n?n:t)(s-0);return a.set(e.subarray(0,s)),a}(i,0,_)},R=new t(0),U="undefined"!=typeof TextDecoder&&new TextDecoder;try{U.decode(R,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),r=0;function n(){var e=t.getUint16(r);return r+=2,e}function o(){var e=t.getUint32(r);return r+=4,e}function s(e){v.setUint16(y,e),y+=2}function a(e){v.setUint32(y,e),y+=4}for(var i={signature:o(),flavor:o(),length:o(),numTables:n(),reserved:n(),totalSfntSize:o(),majorVersion:n(),minorVersion:n(),metaOffset:o(),metaLength:o(),metaOrigLength:o(),privOffset:o(),privLength:o()},l=0;Math.pow(2,l)<=i.numTables;)l++;l--;for(var c=16*Math.pow(2,l),u=16*i.numTables-c,h=12,d=[],f=0;f<i.numTables;f++)d.push({tag:o(),offset:o(),compLength:o(),origLength:o(),origChecksum:o()}),h+=16;var p,g=new Uint8Array(12+16*d.length+d.reduce(function(e,t){return e+t.origLength+4},0)),m=g.buffer,v=new DataView(m),y=0;return a(i.flavor),s(i.numTables),s(c),s(l),s(u),d.forEach(function(e){a(e.tag),a(e.origChecksum),a(h),a(e.origLength),e.outOffset=h,(h+=e.origLength)%4!=0&&(h+=4-h%4)}),d.forEach(function(t){var r,n=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var o=new Uint8Array(t.origLength);r=new Uint8Array(n,2),_(r,o)}else o=new Uint8Array(n);g.set(o,t.outOffset);var s=0;(h=t.outOffset+t.origLength)%4!=0&&(s=4-h%4),g.set(new Uint8Array(s).buffer,t.outOffset+t.origLength),p=h+s}),m.slice(0,p)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){const r={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let o;function s(e){if(!o){const e={R:2,L:1,D:4,C:16,U:32,T:8};o=new Map;for(let t in n){let r=0;n[t].split(",").forEach(n=>{let[s,a]=n.split("+");s=parseInt(s,36),a=a?parseInt(a,36):0,o.set(r+=s,e[t]);for(let n=a;n--;)o.set(++r,e[t])})}}return o.get(e)||32}const a=[null,"isol","init","fina","medi"];function i(e){const t=new Uint8Array(e.length);let r=32,n=1,o=-1;for(let a=0;a<e.length;a++){const i=e.codePointAt(a);let l=0|s(i),c=1;8&l||(21&r?22&l?(c=3,1!==n&&3!==n||t[o]++):33&l&&(2!==n&&4!==n||t[o]--):34&r&&(2!==n&&4!==n||t[o]--),n=t[a]=c,r=l,o=a,i>65535&&a++)}return t}function l(t,r){const n=t.GDEF&&t.GDEF.glyphClassDef;return n?e.U._getGlyphClass(r,n):0}function c(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}function u(t){const n=Object.create(null),o=t["OS/2"],s=t.hhea,u=t.head.unitsPerEm,h=c(o&&o.sTypoAscender,s&&s.ascender,u),d={unitsPerEm:u,ascender:h,descender:c(o&&o.sTypoDescender,s&&s.descender,0),capHeight:c(o&&o.sCapHeight,h),xHeight:c(o&&o.sxHeight,h),lineGap:c(o&&o.sTypoLineGap,s&&s.lineGap),supportsCodePoint:r=>e.U.codeToGlyph(t,r)>0,forEachGlyph(o,s,c,u){let h=0;const f=1/d.unitsPerEm*s,p=function(t,r){const n=[];for(let o=0;o<r.length;o++){const s=r.codePointAt(o);s>65535&&o++,n.push(e.U.codeToGlyph(t,s))}const o=t.GSUB;if(o){const{lookupList:t,featureList:s}=o;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];s.forEach(o=>{if(c.test(o.tag))for(let s=0;s<o.tab.length;s++){if(u[o.tab[s]])continue;u[o.tab[s]]=!0;const c=t[o.tab[s]],h=/^(isol|init|fina|medi)$/.test(o.tag);h&&!l&&(l=i(r));for(let r=0;r<n.length;r++)l&&h&&a[l[r]]!==o.tag||e.U._applySubs(n,r,c,t)}})}return n}(t,o);let g=0;const m=function(t,r){const n=new Int16Array(3*r.length);let o=0;for(;o<r.length;o++){const c=r[o];if(-1===c)continue;n[3*o+2]=t.hmtx.aWidth[c];const u=t.GPOS;if(u){const h=u.lookupList;for(let u=0;u<h.length;u++){const d=h[u];for(let u=0;u<d.tabs.length;u++){const h=d.tabs[u];if(1===d.ltype){if(-1!==e._lctf.coverageIndex(h.coverage,c)&&h.pos){i(h.pos,o);break}}else if(2===d.ltype){let t=null,n=s();if(-1!==n){const s=e._lctf.coverageIndex(h.coverage,r[n]);if(-1!==s){if(1===h.fmt){const e=h.pairsets[s];for(let r=0;r<e.length;r++)e[r].gid2===c&&(t=e[r])}else if(2===h.fmt){const o=e.U._getGlyphClass(r[n],h.classDef1),s=e.U._getGlyphClass(c,h.classDef2);t=h.matrix[o][s]}if(t){t.val1&&i(t.val1,n),t.val2&&i(t.val2,o);break}}}}else if(4===d.ltype){const t=e._lctf.coverageIndex(h.markCoverage,c);if(-1!==t){const i=s(a),l=-1===i?-1:e._lctf.coverageIndex(h.baseCoverage,r[i]);if(-1!==l){const e=h.markArray[t],r=h.baseArray[l][e.markClass];n[3*o]=r.x-e.x+n[3*i]-n[3*i+2],n[3*o+1]=r.y-e.y+n[3*i+1];break}}}else if(6===d.ltype){const a=e._lctf.coverageIndex(h.mark1Coverage,c);if(-1!==a){const i=s();if(-1!==i){const s=r[i];if(3===l(t,s)){const t=e._lctf.coverageIndex(h.mark2Coverage,s);if(-1!==t){const e=h.mark1Array[a],r=h.mark2Array[t][e.markClass];n[3*o]=r.x-e.x+n[3*i]-n[3*i+2],n[3*o+1]=r.y-e.y+n[3*i+1];break}}}}}}}}else if(t.kern&&!t.cff){const e=s();if(-1!==e){const o=t.kern.glyph1.indexOf(r[e]);if(-1!==o){const r=t.kern.rval[o].glyph2.indexOf(c);-1!==r&&(n[3*e+2]+=t.kern.rval[o].vals[r])}}}}return n;function s(e){for(let t=o-1;t>=0;t--)if(-1!==r[t]&&(!e||e(r[t])))return t;return-1}function a(e){return 1===l(t,e)}function i(e,t){for(let r=0;r<3;r++)n[3*t+r]+=e[r]||0}}(t,p);return p.forEach((a,i)=>{if(-1!==a){let o=n[a];if(!o){const{cmds:s,crds:i}=e.U.glyphToPath(t,a);let l,c,u,h,d="",f=0;for(let e=0,t=s.length;e<t;e++){const t=r[s[e]];d+=s[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+i[f++]}if(i.length){l=c=1/0,u=h=-1/0;for(let e=0,t=i.length;e<t;e+=2){let t=i[e],r=i[e+1];t<l&&(l=t),r<c&&(c=r),t>u&&(u=t),r>h&&(h=r)}}else l=u=c=h=0;o=n[a]={index:a,advanceWidth:t.hmtx.aWidth[a],xMin:l,yMin:c,xMax:u,yMax:h,path:d}}u.call(null,o,h+m[3*i]*f,m[3*i+1]*f,g),h+=m[3*i+2]*f,c&&(h+=c*s)}g+=o.codePointAt(g)>65535?2:1}),h}};return d}return function(r){const n=new Uint8Array(r,0,4),o=e._bin.readASCII(n,0,4);if("wOFF"===o)r=t(r);else if("wOF2"===o)throw new Error("woff2 fonts not supported");return u(e.parse(r)[0])}}],init:(e,t,r)=>r(e(),t())});
/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/const wr=sr({name:"FontResolver",dependencies:[function(e,t){const r=Object.create(null),n=Object.create(null);function o(t,o){let s=r[t];s?o(s):n[t]?n[t].push(o):(n[t]=[o],function(t,r){const n=e=>{console.error(`Failure loading font ${t}`,e)};try{const o=new XMLHttpRequest;o.open("get",t,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const n=e(o.response);n.src=t,r(n)}catch(e){n(e)}},o.onerror=n,o.send()}catch(e){n(e)}}(t,e=>{e.src=t,r[t]=e,n[t].forEach(t=>t(e)),delete n[t]}))}return function(e,n,{lang:s,fonts:a=[],style:i="normal",weight:l="normal",unicodeFontsURL:c}={}){const u=new Uint8Array(e.length),h=[];e.length||g();const d=new Map,f=[];if("italic"!==i&&(i="normal"),"number"!=typeof l&&(l="bold"===l?700:400),a&&!Array.isArray(a)&&(a=[a]),(a=a.slice().filter(e=>!e.lang||e.lang.test(s)).reverse()).length){const t=1,n=2;let s=0;!function i(l=0){for(let c=l,p=e.length;c<p;c++){const l=e.codePointAt(c);if(s===t&&h[u[c-1]].supportsCodePoint(l)||c>0&&/\s/.test(e[c]))u[c]=u[c-1],s===n&&(f[f.length-1][1]=c);else for(let e=u[c],p=a.length;e<=p;e++)if(e===p){(s===n?f[f.length-1]:f[f.length]=[c,c])[1]=c,s=n}else{u[c]=e;const{src:n,unicodeRange:f}=a[e];if(!f||m(l,f)){const e=r[n];if(!e)return void o(n,()=>{i(c)});if(e.supportsCodePoint(l)){let r=d.get(e);"number"!=typeof r&&(r=h.length,h.push(e),d.set(e,r)),u[c]=r,s=t;break}}}l>65535&&c+1<p&&(u[c+1]=u[c],c++,s===n&&(f[f.length-1][1]=c))}p()}()}else f.push([0,e.length-1]),p();function p(){if(f.length){const r=f.map(t=>e.substring(t[0],t[1]+1)).join("\n");t.getFontsForString(r,{lang:s||void 0,style:i,weight:l,dataUrl:c}).then(({fontUrls:e,chars:t})=>{const r=h.length;let n=0;f.forEach(e=>{for(let o=0,s=e[1]-e[0];o<=s;o++)u[e[0]+o]=t[n++]+r;n++});let s=0;e.forEach((t,n)=>{o(t,t=>{h[n+r]=t,++s===e.length&&g()})})})}else g()}function g(){n({chars:u,fonts:h})}function m(e,t){for(let r=0;r<t.length;r++){const[n,o=n]=t[r];if(n<=e&&e<=o)return!0}return!1}}},Tr,function(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&!!(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach(function(t,r){e.push((+r).toString(36)+":"+t.toString(36))}),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach(function(e){var r=e.split(":");t.buckets.set(parseInt(r[0],36),parseInt(r[1],36))})};var r=Math.pow(2,8),n=r-1,o=~n;function s(e){var t=function(e){return e&o}(e).toString(16),n=function(e){return(e&o)+r-1}(e).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+t+"-"+n+".json"}function a(e,t){var r=e&n,o=t.codePointAt(r/6|0);return!!((o=(o||48)-48)&1<<r%6)}function i(e,t){!function(e,t){var r;(r=e,r.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(e){return e.split("-").map(function(e){return parseInt(e.trim(),16)})})).forEach(function(e){var r=e[0],n=e[1];void 0===n&&(n=r),t(r,n)})}(e,function(e,r){for(var n=e;n<=r;n++)t(n)})}var l={},c={},u=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(e){var r=u.get(e);return r||(r=new t,i(e.ranges,function(e){return r.add(e)}),u.set(e,r)),r}var f,p=new Map;function g(e,t,r){return e[t]?t:e[r]?r:function(e){for(var t in e)return t}(e)}function m(e,t){var r=t;if(!e.includes(r)){r=1/0;for(var n=0;n<e.length;n++)Math.abs(e[n]-t)<Math.abs(r-t)&&(r=e[n])}return r}function v(e){return f||(f=new Set,i("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(e){f.add(e)})),f.has(e)}return e.CodePointSet=t,e.clearCache=function(){l={},c={}},e.getFontsForString=function(e,t){void 0===t&&(t={});var r,n=t.lang;void 0===n&&(n=/\p{Script=Hangul}/u.test(r=e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(r)?"ja":"en");var o=t.category;void 0===o&&(o="sans-serif");var i=t.style;void 0===i&&(i="normal");var u=t.weight;void 0===u&&(u=400);var f=(t.dataUrl||h).replace(/\/$/g,""),y=new Map,x=new Uint8Array(e.length),b={},S={},T=new Array(e.length),w=new Map,A=!1;function _(e){var t=p.get(e);return t||(t=fetch(f+"/"+e).then(function(e){if(!e.ok)throw new Error(e.statusText);return e.json().then(function(e){if(!Array.isArray(e)||1!==e[0])throw new Error("Incorrect schema version; need 1, got "+e[0]);return e[1]})}).catch(function(t){if(f!==h)return A||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+f+'", trying default CDN. '+t.message),A=!0),f=h,p.delete(e),_(e);throw t}),p.set(e,t)),t}for(var R=function(t){var r=e.codePointAt(t),n=s(r);T[t]=n,l[n]||w.has(n)||w.set(n,_(n).then(function(e){l[n]=e})),r>65535&&(t++,U=t)},U=0;U<e.length;U++)R(U);return Promise.all(w.values()).then(function(){w.clear();for(var t=function(t){var o=e.codePointAt(t),s=null,i=l[T[t]],u=void 0;for(var h in i){var d=S[h];if(void 0===d&&(d=S[h]=new RegExp(h).test(n||"en")),d){for(var f in u=h,i[h])if(a(o,i[h][f])){s=f;break}break}}if(!s)e:for(var p in i)if(p!==u)for(var g in i[p])if(a(o,i[p][g])){s=g;break e}s||(console.debug("No font coverage for U+"+o.toString(16)),s="latin"),T[t]=s,c[s]||w.has(s)||w.set(s,_("font-meta/"+s+".json").then(function(e){c[s]=e})),o>65535&&(t++,r=t)},r=0;r<e.length;r++)t(r);return Promise.all(w.values())}).then(function(){for(var t,r=null,n=0;n<e.length;n++){var s=e.codePointAt(n);if(r&&(v(s)||d(r).has(s)))x[n]=x[n-1];else{r=c[T[n]];var a=b[r.id];if(!a){var l=r.typeforms,h=g(l,o,"sans-serif"),p=g(l[h],i,"normal"),S=m(null===(t=l[h])||void 0===t?void 0:t[p],u);a=b[r.id]=f+"/font-files/"+r.id+"/"+h+"."+p+"."+S+".woff"}var w=y.get(a);null==w&&(w=y.size,y.set(a,w)),x[n]=w}s>65535&&(n++,x[n]=x[n-1])}return{fontUrls:Array.from(y.keys()),chars:x}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())});const Ar=()=>(self.performance||Date).now(),_r=lr();let Rr;const Ur=[];let Cr=0;function kr(){const e=Ar();for(;Ur.length&&Ar()-e<5;)Ur.shift()();Cr=Ur.length?setTimeout(kr,0):0}const Er=(...e)=>new Promise((t,r)=>{Ur.push(()=>{const n=Ar();try{_r.webgl.generateIntoCanvas(...e),t({timing:Ar()-n})}catch(e){r(e)}}),Cr||(Cr=setTimeout(kr,0))}),Ir=4,Lr=2e3,Mr={};let Fr=0;function Dr(e,t,r,n,o,s,a,i,l,c){const u="TroikaTextSDFGenerator_JS_"+Fr++%Ir;let h=Mr[u];return h||(h=Mr[u]={workerModule:sr({name:u,workerId:u,dependencies:[lr,Ar],init(e,t){const r=e().javascript.generate;return function(...e){const n=t();return{textureData:r(...e),timing:t()-n}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(e,t,r,n,o,s).then(({textureData:r,timing:n})=>{const o=Ar(),s=new Uint8Array(4*r.length);for(let e=0;e<r.length;e++)s[4*e+c]=r[e];return _r.webglUtils.renderImageData(a,s,i,l,e,t,1<<3-c),n+=Ar()-o,0===--h.requests&&(h.idleTimer=setTimeout(()=>{!function(e){nr[e]&&nr[e].forEach(function(e){e()}),rr[e]&&(rr[e].terminate(),delete rr[e])}(u)},Lr)),{timing:n}})}const Pr=_r.webglUtils.resizeWebGLCanvasWithoutClearing,Or={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Gr=new c;function Br(){return(self.performance||Date).now()}const Nr=Object.create(null);function Hr(e,t){e=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e);const r=Br(),n=[];if(e.font&&n.push({label:"user",src:Wr(e.font)}),e.font=n,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||Or.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||Or.unicodeFontsURL,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let n=e.colorRanges[r];"number"!=typeof n&&(n=Gr.set(n).getHex()),t[r]=n}e.colorRanges=t}Object.freeze(e);const{textureWidth:o,sdfExponent:s}=Or,{sdfGlyphSize:a}=e,i=o/a*4;let l=Nr[a];if(!l){const e=document.createElement("canvas");e.width=o,e.height=256*a/i,l=Nr[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:e,sdfTexture:new oe(e,void 0,void 0,void 0,E,E),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,function(e){const t=e.sdfCanvas;t.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),e.contextLost=!0}),t.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),e.contextLost=!1;const r=[];e.glyphsByFont.forEach(t=>{t.forEach(t=>{r.push(jr(t,e,!0))})}),Promise.all(r).then(()=>{Vr(e),e.sdfTexture.needsUpdate=!0})})}(l)}const{sdfTexture:c,sdfCanvas:u}=l;qr(e).then(n=>{const{glyphIds:h,glyphFontIndices:d,fontData:f,glyphPositions:p,fontSize:g,timings:m}=n,v=[],y=new Float32Array(4*h.length);let x=0,b=0;const S=Br(),T=f.map(e=>{let t=l.glyphsByFont.get(e.src);return t||l.glyphsByFont.set(e.src,t=new Map),t});h.forEach((e,t)=>{const r=d[t],{src:o,unitsPerEm:s}=f[r];let i=T[r].get(e);if(!i){const{path:t,pathBounds:s}=n.glyphData[o][e],c=Math.max(s[2]-s[0],s[3]-s[1])/a*(Or.sdfMargin*a+.5),u=l.glyphCount++,h=[s[0]-c,s[1]-c,s[2]+c,s[3]+c];T[r].set(e,i={path:t,atlasIndex:u,sdfViewBox:h}),v.push(i)}const{sdfViewBox:c}=i,u=p[b++],m=p[b++],S=g/s;y[x++]=u+c[0]*S,y[x++]=m+c[1]*S,y[x++]=u+c[2]*S,y[x++]=m+c[3]*S,h[t]=i.atlasIndex}),m.quads=(m.quads||0)+(Br()-S);const w=Br();m.sdf={};const A=u.height,_=Math.ceil(l.glyphCount/i),R=Math.pow(2,Math.ceil(Math.log2(_*a)));R>A&&(console.info(`Increasing SDF texture size ${A}->${R}`),Pr(u,o,R),c.dispose()),Promise.all(v.map(t=>jr(t,l,e.gpuAccelerateSDF).then(({timing:e})=>{m.sdf[t.atlasIndex]=e}))).then(()=>{v.length&&!l.contextLost&&(Vr(l),c.needsUpdate=!0),m.sdfTotal=Br()-w,m.total=Br()-r,t(Object.freeze({parameters:e,sdfTexture:c,sdfGlyphSize:a,sdfExponent:s,glyphBounds:y,glyphAtlasIndices:h,glyphColors:n.glyphColors,caretPositions:n.caretPositions,chunkedBounds:n.chunkedBounds,ascender:n.ascender,descender:n.descender,lineHeight:n.lineHeight,capHeight:n.capHeight,xHeight:n.xHeight,topBaseline:n.topBaseline,blockBounds:n.blockBounds,visibleBounds:n.visibleBounds,timings:n.timings}))})}),Promise.resolve().then(()=>{var e;l.contextLost||(e=u)._warm||(_r.webgl.isSupported(e),e._warm=!0)})}function jr({path:e,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:n,sdfCanvas:o,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:l}=Or,c=Math.max(r[2]-r[0],r[3]-r[1]),u=Math.floor(t/4);return function(e,t,r,n,o,s,a,i,l,c,u=!0){return u?Er(e,t,r,n,o,s,a,i,l,c).then(null,u=>(Rr||(console.warn("WebGL SDF generation failed, falling back to JS",u),Rr=!0),Dr(e,t,r,n,o,s,a,i,l,c))):Dr(e,t,r,n,o,s,a,i,l,c)}(n,n,e,r,c,l,o,u%(i/n)*n,Math.floor(u/(i/n))*n,t%4,a)}let zr;function Wr(e){return zr||(zr="undefined"==typeof document?{}:document.createElement("a")),zr.href=e,zr.href}function Vr(e){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:r}=e,{width:n,height:o}=t,s=e.sdfCanvas.getContext("webgl");let a=r.image.data;a&&a.length===n*o*4||(a=new Uint8Array(n*o*4),r.image={width:n,height:o,data:a},r.flipY=!1,r.isDataTexture=!0),s.readPixels(0,0,n,o,s.RGBA,s.UNSIGNED_BYTE,a)}}const Xr=sr({name:"Typesetter",dependencies:[function(e,t){const r=1/0,n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,o="[^\\S\\u00A0]",s=new RegExp(`${o}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:a="",font:h,lang:d,sdfGlyphSize:f=64,fontSize:p=400,fontWeight:g=1,fontStyle:m="normal",letterSpacing:v=0,lineHeight:y="normal",maxWidth:x=r,direction:b,textAlign:S="left",textIndent:T=0,whiteSpace:w="normal",overflowWrap:A="normal",anchorX:_=0,anchorY:R=0,metricsOnly:U=!1,unicodeFontsURL:C,preResolvedFonts:k=null,includeCaretPositions:E=!1,chunkedBoundsSize:I=8192,colorRanges:L=null},M){const F=c(),D={fontLoad:0,typesetting:0};a.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,v=+v,x=+x,y=y||"normal",T=+T,function({text:t,lang:r,fonts:n,style:o,weight:s,preResolvedFonts:a,unicodeFontsURL:i},l){const c=({chars:e,fonts:t})=>{let r,n;const o=[];for(let s=0;s<e.length;s++)e[s]!==n?(n=e[s],o.push(r={start:s,end:s,fontObj:t[e[s]]})):r.end=s;l(o)};a?c(a):e(t,c,{lang:r,fonts:n,style:o,weight:s,unicodeFontsURL:i})}({text:a,lang:d,style:m,weight:g,fonts:"string"==typeof h?[{src:h}]:h,unicodeFontsURL:C,preResolvedFonts:k},e=>{D.fontLoad=c()-F;const h=isFinite(x);let d=null,f=null,g=null,m=null,C=null,k=null,P=null,O=null,G=0,B=0,N="nowrap"!==w;const H=new Map,j=c();let z=T,W=0,V=new u;const X=[V];e.forEach(e=>{const{fontObj:t}=e,{ascender:r,descender:i,unitsPerEm:l,lineGap:c,capHeight:d,xHeight:f}=t;let g=H.get(t);if(!g){const e=p/l,n="normal"===y?(r-i+c)*e:y*p,o=(n-(r-i)*e)/2,s=Math.min(n,(r-i)*e),a=(r+i)/2*e+s/2;g={index:H.size,src:t.src,fontObj:t,fontSizeMult:e,unitsPerEm:l,ascender:r*e,descender:i*e,capHeight:d*e,xHeight:f*e,lineHeight:n,baseline:-o-r*e,caretTop:a,caretBottom:a-s},H.set(t,g)}const{fontSizeMult:m}=g,b=a.slice(e.start,e.end+1);let S,w;t.forEachGlyph(b,p,v,(t,r,i,l)=>{r+=W,l+=e.start,S=r,w=t;const c=a.charAt(l),d=t.advanceWidth*m,f=V.count;let y;if("isEmpty"in t||(t.isWhitespace=!!c&&new RegExp(o).test(c),t.canBreakAfter=!!c&&s.test(c),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||n.test(c)),t.isWhitespace||t.isEmpty||B++,N&&h&&!t.isWhitespace&&r+d+z>x&&f){if(V.glyphAt(f-1).glyphObj.canBreakAfter)y=new u,z=-r;else for(let e=f;e--;){if(0===e&&"break-word"===A){y=new u,z=-r;break}if(V.glyphAt(e).glyphObj.canBreakAfter){y=V.splitAt(e+1);const t=y.glyphAt(0).x;z-=t;for(let e=y.count;e--;)y.glyphAt(e).x-=t;break}}y&&(V.isSoftWrapped=!0,V=y,X.push(V),G=x)}let b=V.glyphAt(V.count);b.glyphObj=t,b.x=r+z,b.y=i,b.width=d,b.charIndex=l,b.fontData=g,"\n"===c&&(V=new u,X.push(V),z=-(r+d+v*p)+T)}),W=S+w.advanceWidth*m+v*p});let q=0;X.forEach(e=>{let t=!0;for(let r=e.count;r--;){const n=e.glyphAt(r);t&&!n.glyphObj.isWhitespace&&(e.width=n.x+n.width,e.width>G&&(G=e.width),t=!1);let{lineHeight:o,capHeight:s,xHeight:a,baseline:i}=n.fontData;o>e.lineHeight&&(e.lineHeight=o);const l=i-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+s),e.ex=Math.max(e.ex,e.baseline+a)}e.baseline-=q,e.cap-=q,e.ex-=q,q+=e.lineHeight});let $=0,K=0;if(_&&("number"==typeof _?$=-_:"string"==typeof _&&($=-G*("left"===_?0:"center"===_?.5:"right"===_?1:i(_)))),R&&("number"==typeof R?K=-R:"string"==typeof R&&(K="top"===R?0:"top-baseline"===R?-X[0].baseline:"top-cap"===R?-X[0].cap:"top-ex"===R?-X[0].ex:"middle"===R?q/2:"bottom"===R?q:"bottom-baseline"===R?-X[X.length-1].baseline:i(R)*q)),!U){const e=t.getEmbeddingLevels(a,b);d=new Uint16Array(B),f=new Uint8Array(B),g=new Float32Array(2*B),m={},P=[r,r,-1/0,-1/0],O=[],E&&(k=new Float32Array(4*a.length)),L&&(C=new Uint8Array(3*B));let n,o,s=0,i=-1,c=-1;if(X.forEach((u,h)=>{let{count:p,width:v}=u;if(p>0){let h=0;for(let e=p;e--&&u.glyphAt(e).glyphObj.isWhitespace;)h++;let y=0,x=0;if("center"===S)y=(G-v)/2;else if("right"===S)y=G-v;else if("justify"===S&&u.isSoftWrapped){let e=0;for(let t=p-h;t--;)u.glyphAt(t).glyphObj.isWhitespace&&e++;x=(G-v)/e}if(x||y){let e=0;for(let t=0;t<p;t++){let r=u.glyphAt(t);const n=r.glyphObj;r.x+=y+e,0!==x&&n.isWhitespace&&t<p-h&&(e+=x,r.width+=x)}}const b=t.getReorderSegments(a,e,u.glyphAt(0).charIndex,u.glyphAt(u.count-1).charIndex);for(let e=0;e<b.length;e++){const[t,r]=b[e];let n=1/0,o=-1/0;for(let e=0;e<p;e++)if(u.glyphAt(e).charIndex>=t){let t=e,s=e;for(;s<p;s++){let e=u.glyphAt(s);if(e.charIndex>r)break;s<p-h&&(n=Math.min(n,e.x),o=Math.max(o,e.x+e.width))}for(let e=t;e<s;e++){const t=u.glyphAt(e);t.x=o-(t.x+t.width-n)}break}}let T;const w=e=>T=e;for(let h=0;h<p;h++){const p=u.glyphAt(h);T=p.glyphObj;const v=T.index,y=1&e.levels[p.charIndex];if(y){const e=t.getMirroredCharacter(a[p.charIndex]);e&&p.fontData.fontObj.forEachGlyph(e,0,0,w)}if(E){const{charIndex:e,fontData:t}=p,r=p.x+$,n=p.x+p.width+$;k[4*e]=y?n:r,k[4*e+1]=y?r:n,k[4*e+2]=u.baseline+t.caretBottom+K,k[4*e+3]=u.baseline+t.caretTop+K;const o=e-i;o>1&&l(k,i,o),i=e}if(L){const{charIndex:e}=p;for(;e>c;)c++,L.hasOwnProperty(c)&&(o=L[c])}if(!T.isWhitespace&&!T.isEmpty){const e=s++,{fontSizeMult:t,src:a,index:i}=p.fontData,l=m[a]||(m[a]={});l[v]||(l[v]={path:T.path,pathBounds:[T.xMin,T.yMin,T.xMax,T.yMax]});const c=p.x+$,h=p.y+u.baseline+K;g[2*e]=c,g[2*e+1]=h;const y=c+T.xMin*t,x=h+T.yMin*t,b=c+T.xMax*t,S=h+T.yMax*t;y<P[0]&&(P[0]=y),x<P[1]&&(P[1]=x),b>P[2]&&(P[2]=b),S>P[3]&&(P[3]=S),e%I===0&&(n={start:e,end:e,rect:[r,r,-1/0,-1/0]},O.push(n)),n.end++;const w=n.rect;if(y<w[0]&&(w[0]=y),x<w[1]&&(w[1]=x),b>w[2]&&(w[2]=b),S>w[3]&&(w[3]=S),d[e]=v,f[e]=i,L){const t=3*e;C[t]=o>>16&255,C[t+1]=o>>8&255,C[t+2]=255&o}}}}}),k){const e=a.length-i;e>1&&l(k,i,e)}}const Y=[];H.forEach(({index:e,src:t,unitsPerEm:r,ascender:n,descender:o,lineHeight:s,capHeight:a,xHeight:i})=>{Y[e]={src:t,unitsPerEm:r,ascender:n,descender:o,lineHeight:s,capHeight:a,xHeight:i}}),D.typesetting=c()-j,M({glyphIds:d,glyphFontIndices:f,glyphPositions:g,glyphData:m,fontData:Y,caretPositions:k,glyphColors:C,chunkedBounds:O,fontSize:p,topBaseline:K+X[0].baseline,blockBounds:[$,K-q,$+G,K],visibleBounds:P,timings:D})})}function i(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function l(e,t,r){const n=e[4*t],o=e[4*t+1],s=e[4*t+2],a=e[4*t+3],i=(o-n)/r;for(let o=0;o<r;o++){const r=4*(t+o);e[r]=n+i*o,e[r+1]=n+i*(o+1),e[r+2]=s,e[r+3]=a}}function c(){return(self.performance||Date).now()}function u(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(e){let t=u.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new u;return t.data=this.data.splice(e*h.length),t}},u.flyweight=h.reduce((e,t,r,n)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*h.length+r]},set(e){this.data[this.index*h.length+r]=e}}),e),{data:null,index:0}),{typeset:a,measure:function(e,t){a({...e,metricsOnly:!0},e=>{const[r,n,o,s]=e.blockBounds;t({width:o-r,height:s-n})})}}},wr,function(){return function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},n={};r.L=1,n[1]="L",Object.keys(t).forEach(function(e,t){r[e]=1<<t+1,n[r[e]]=e}),Object.freeze(r);var o=r.LRI|r.RLI|r.FSI,s=r.L|r.R|r.AL,a=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,i=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,l=r.S|r.WS|r.B|o|r.PDI|i,c=null;function u(e){return function(){if(!c){c=new Map;var e=function(e){if(t.hasOwnProperty(e)){var n=0;t[e].split(",").forEach(function(t){var o=t.split("+"),s=o[0],a=o[1];s=parseInt(s,36),a=a?parseInt(a,36):0,c.set(n+=s,r[e]);for(var i=0;i<a;i++)c.set(++n,r[e])})}};for(var n in t)e(n)}}(),c.get(e.codePointAt(0))||r.L}var h,d,f,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",g="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function m(e,t){var r,n=0,o=new Map,s=t&&new Map;return e.split(",").forEach(function e(a){if(-1!==a.indexOf("+"))for(var i=+a;i--;)e(r);else{r=a;var l=a.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(n+=parseInt(c,36)),u=String.fromCodePoint(n+=parseInt(u,36)),o.set(c,u),t&&s.set(u,c)}}),{map:o,reverseMap:s}}function v(){if(!h){var e=m(p,!0),t=e.map,r=e.reverseMap;h=t,d=r,f=m(g,!1).map}}function y(e){return v(),h.get(e)||null}function x(e){return v(),d.get(e)||null}function b(e){return v(),f.get(e)||null}var S=r.L,T=r.R,w=r.EN,A=r.ES,_=r.ET,R=r.AN,U=r.CS,C=r.B,k=r.S,E=r.ON,I=r.BN,L=r.NSM,M=r.AL,F=r.LRO,D=r.RLO,P=r.LRE,O=r.RLE,G=r.PDF,B=r.LRI,N=r.RLI,H=r.FSI,j=r.PDI;var z;function W(e){return function(){if(!z){var e=m("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,r){t.set(r,e)}),z=t}}(),z.get(e)||null}function V(e,t,r,n){var o=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(o-1,null==n?o-1:+n);var s=[];return t.paragraphs.forEach(function(o){var a=Math.max(r,o.start),i=Math.min(n,o.end);if(a<i){for(var c=t.levels.slice(a,i+1),h=i;h>=a&&u(e[h])&l;h--)c[h]=o.level;for(var d=o.level,f=1/0,p=0;p<c.length;p++){var g=c[p];g>d&&(d=g),g<f&&(f=1|g)}for(var m=d;m>=f;m--)for(var v=0;v<c.length;v++)if(c[v]>=m){for(var y=v;v+1<c.length&&c[v+1]>=m;)v++;v>y&&s.push([y+a,v+a])}}}),s}function X(e,t,r,n){for(var o=V(e,t,r,n),s=[],a=0;a<e.length;a++)s[a]=a;return o.forEach(function(e){for(var t=e[0],r=e[1],n=s.slice(t,r+1),o=n.length;o--;)s[r-o]=n[o]}),s}return e.closingToOpeningBracket=x,e.getBidiCharType=u,e.getBidiCharTypeName=function(e){return n[u(e)]},e.getCanonicalBracket=b,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),n=0;n<e.length;n++)r[n]=u(e[n]);var c=new Map;function h(e,t){var n=r[e];r[e]=t,c.set(n,c.get(n)-1),n&a&&c.set(a,c.get(a)-1),c.set(t,(c.get(t)||0)+1),t&a&&c.set(a,(c.get(a)||0)+1)}for(var d=new Uint8Array(e.length),f=new Map,p=[],g=null,m=0;m<e.length;m++)g||p.push(g={start:m,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:Ht(m,!1)}),r[m]&C&&(g.end=m,g=null);for(var v=O|P|D|F|o|j|G|C,z=function(e){return e+(1&e?1:2)},W=function(e){return e+(1&e?2:1)},V=0;V<p.length;V++){var X=[{_level:(g=p[V]).level,_override:0,_isolate:0}],q=void 0,$=0,K=0,Y=0;c.clear();for(var Q=g.start;Q<=g.end;Q++){var Z=r[Q];if(q=X[X.length-1],c.set(Z,(c.get(Z)||0)+1),Z&a&&c.set(a,(c.get(a)||0)+1),Z&v)if(Z&(O|P)){d[Q]=q._level;var J=(Z===O?W:z)(q._level);J<=125&&!$&&!K?X.push({_level:J,_override:0,_isolate:0}):$||K++}else if(Z&(D|F)){d[Q]=q._level;var ee=(Z===D?W:z)(q._level);ee<=125&&!$&&!K?X.push({_level:ee,_override:Z&D?T:S,_isolate:0}):$||K++}else if(Z&o){Z&H&&(Z=1===Ht(Q+1,!0)?N:B),d[Q]=q._level,q._override&&h(Q,q._override);var te=(Z===N?W:z)(q._level);te<=125&&0===$&&0===K?(Y++,X.push({_level:te,_override:0,_isolate:1,_isolInitIndex:Q})):$++}else if(Z&j){if($>0)$--;else if(Y>0){for(K=0;!X[X.length-1]._isolate;)X.pop();var re=X[X.length-1]._isolInitIndex;null!=re&&(f.set(re,Q),f.set(Q,re)),X.pop(),Y--}q=X[X.length-1],d[Q]=q._level,q._override&&h(Q,q._override)}else Z&G?(0===$&&(K>0?K--:!q._isolate&&X.length>1&&(X.pop(),q=X[X.length-1])),d[Q]=q._level):Z&C&&(d[Q]=g.level);else d[Q]=q._level,q._override&&Z!==I&&h(Q,q._override)}for(var ne=[],oe=null,se=g.start;se<=g.end;se++){var ae=r[se];if(!(ae&i)){var ie=d[se],le=ae&o,ce=ae===j;oe&&ie===oe._level?(oe._end=se,oe._endsWithIsolInit=le):ne.push(oe={_start:se,_end:se,_level:ie,_startsWithPDI:ce,_endsWithIsolInit:le})}}for(var ue=[],he=0;he<ne.length;he++){var de=ne[he];if(!de._startsWithPDI||de._startsWithPDI&&!f.has(de._start)){for(var fe=[oe=de],pe=void 0;oe&&oe._endsWithIsolInit&&null!=(pe=f.get(oe._end));)for(var ge=he+1;ge<ne.length;ge++)if(ne[ge]._start===pe){fe.push(oe=ne[ge]);break}for(var me=[],ve=0;ve<fe.length;ve++)for(var ye=fe[ve],xe=ye._start;xe<=ye._end;xe++)me.push(xe);for(var be=d[me[0]],Se=g.level,Te=me[0]-1;Te>=0;Te--)if(!(r[Te]&i)){Se=d[Te];break}var we=me[me.length-1],Ae=d[we],_e=g.level;if(!(r[we]&o))for(var Re=we+1;Re<=g.end;Re++)if(!(r[Re]&i)){_e=d[Re];break}ue.push({_seqIndices:me,_sosType:Math.max(Se,be)%2?T:S,_eosType:Math.max(_e,Ae)%2?T:S})}}for(var Ue=0;Ue<ue.length;Ue++){var Ce=ue[Ue],ke=Ce._seqIndices,Ee=Ce._sosType,Ie=Ce._eosType,Le=1&d[ke[0]]?T:S;if(c.get(L))for(var Me=0;Me<ke.length;Me++){var Fe=ke[Me];if(r[Fe]&L){for(var De=Ee,Pe=Me-1;Pe>=0;Pe--)if(!(r[ke[Pe]]&i)){De=r[ke[Pe]];break}h(Fe,De&(o|j)?E:De)}}if(c.get(w))for(var Oe=0;Oe<ke.length;Oe++){var Ge=ke[Oe];if(r[Ge]&w)for(var Be=Oe-1;Be>=-1;Be--){var Ne=-1===Be?Ee:r[ke[Be]];if(Ne&s){Ne===M&&h(Ge,R);break}}}if(c.get(M))for(var He=0;He<ke.length;He++){var je=ke[He];r[je]&M&&h(je,T)}if(c.get(A)||c.get(U))for(var ze=1;ze<ke.length-1;ze++){var We=ke[ze];if(r[We]&(A|U)){for(var Ve=0,Xe=0,qe=ze-1;qe>=0&&(Ve=r[ke[qe]])&i;qe--);for(var $e=ze+1;$e<ke.length&&(Xe=r[ke[$e]])&i;$e++);Ve===Xe&&(r[We]===A?Ve===w:Ve&(w|R))&&h(We,Ve)}}if(c.get(w))for(var Ke=0;Ke<ke.length;Ke++){var Ye=ke[Ke];if(r[Ye]&w){for(var Qe=Ke-1;Qe>=0&&r[ke[Qe]]&(_|i);Qe--)h(ke[Qe],w);for(Ke++;Ke<ke.length&&r[ke[Ke]]&(_|i|w);Ke++)r[ke[Ke]]!==w&&h(ke[Ke],w)}}if(c.get(_)||c.get(A)||c.get(U))for(var Ze=0;Ze<ke.length;Ze++){var Je=ke[Ze];if(r[Je]&(_|A|U)){h(Je,E);for(var et=Ze-1;et>=0&&r[ke[et]]&i;et--)h(ke[et],E);for(var tt=Ze+1;tt<ke.length&&r[ke[tt]]&i;tt++)h(ke[tt],E)}}if(c.get(w))for(var rt=0,nt=Ee;rt<ke.length;rt++){var ot=ke[rt],st=r[ot];st&w?nt===S&&h(ot,S):st&s&&(nt=st)}if(c.get(a)){for(var at=T|w|R,it=at|S,lt=[],ct=[],ut=0;ut<ke.length;ut++)if(r[ke[ut]]&a){var ht=e[ke[ut]],dt=void 0;if(null!==y(ht)){if(!(ct.length<63))break;ct.push({char:ht,seqIndex:ut})}else if(null!==(dt=x(ht)))for(var ft=ct.length-1;ft>=0;ft--){var pt=ct[ft].char;if(pt===dt||pt===x(b(ht))||y(b(pt))===ht){lt.push([ct[ft].seqIndex,ut]),ct.length=ft;break}}}lt.sort(function(e,t){return e[0]-t[0]});for(var gt=0;gt<lt.length;gt++){for(var mt=lt[gt],vt=mt[0],yt=mt[1],xt=!1,bt=0,St=vt+1;St<yt;St++){var Tt=ke[St];if(r[Tt]&it){xt=!0;var wt=r[Tt]&at?T:S;if(wt===Le){bt=wt;break}}}if(xt&&!bt){bt=Ee;for(var At=vt-1;At>=0;At--){var _t=ke[At];if(r[_t]&it){var Rt=r[_t]&at?T:S;bt=Rt!==Le?Rt:Le;break}}}if(bt){if(r[ke[vt]]=r[ke[yt]]=bt,bt!==Le)for(var Ut=vt+1;Ut<ke.length;Ut++)if(!(r[ke[Ut]]&i)){u(e[ke[Ut]])&L&&(r[ke[Ut]]=bt);break}if(bt!==Le)for(var Ct=yt+1;Ct<ke.length;Ct++)if(!(r[ke[Ct]]&i)){u(e[ke[Ct]])&L&&(r[ke[Ct]]=bt);break}}}for(var kt=0;kt<ke.length;kt++)if(r[ke[kt]]&a){for(var Et=kt,It=kt,Lt=Ee,Mt=kt-1;Mt>=0;Mt--){if(!(r[ke[Mt]]&i)){Lt=r[ke[Mt]]&at?T:S;break}Et=Mt}for(var Ft=Ie,Dt=kt+1;Dt<ke.length;Dt++){if(!(r[ke[Dt]]&(a|i))){Ft=r[ke[Dt]]&at?T:S;break}It=Dt}for(var Pt=Et;Pt<=It;Pt++)r[ke[Pt]]=Lt===Ft?Lt:Le;kt=It}}}for(var Ot=g.start;Ot<=g.end;Ot++){var Gt=d[Ot],Bt=r[Ot];if(1&Gt?Bt&(S|w|R)&&d[Ot]++:Bt&T?d[Ot]++:Bt&(R|w)&&(d[Ot]+=2),Bt&i&&(d[Ot]=0===Ot?g.level:d[Ot-1]),Ot===g.end||u(e[Ot])&(k|C))for(var Nt=Ot;Nt>=0&&u(e[Nt])&l;Nt--)d[Nt]=g.level}}return{levels:d,paragraphs:p};function Ht(t,n){for(var s=t;s<e.length;s++){var a=r[s];if(a&(T|M))return 1;if(a&(C|S)||n&&a===j)return 0;if(a&o){var i=jt(s);s=-1===i?e.length:i}}return 0}function jt(t){for(var n=1,s=t+1;s<e.length;s++){var a=r[s];if(a&C)break;if(a&j){if(0===--n)return s}else a&o&&n++}return-1}},e.getMirroredCharacter=W,e.getMirroredCharactersMap=function(e,t,r,n){var o=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(o-1,null==n?o-1:+n);for(var s=new Map,a=r;a<=n;a++)if(1&t[a]){var i=W(e[a]);null!==i&&s.set(a,i)}return s},e.getReorderSegments=V,e.getReorderedIndices=X,e.getReorderedString=function(e,t,r,n){var o=X(e,t,r,n),s=[].concat(e);return o.forEach(function(r,n){s[n]=(1&t.levels[r]?W(e[r]):null)||e[r]}),s.join("")},e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())}),qr=sr({name:"Typesetter",dependencies:[Xr],init:e=>function(t){return new Promise(r=>{e.typeset(t,r)})},getTransferables(e){const t=[];for(let r in e)e[r]&&e[r].buffer&&t.push(e[r].buffer);return t}});qr.onMainThread;const $r={};const Kr="aTroikaGlyphIndex";class Yr extends we{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new de,this.boundingBox=new he}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let t=function(e){let t=$r[e];return t||(t=$r[e]=new Re(1,1,e,e).translate(.5,.5,0)),t}(e);["position","normal","uv"].forEach(e=>{this.attributes[e]=t.attributes[e].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,r,n,o){this.updateAttributeData("aTroikaGlyphBounds",e,4),this.updateAttributeData(Kr,t,1),this.updateAttributeData("aTroikaGlyphColor",o,3),this._blockBounds=r,this._chunkedBounds=n,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:r}=this;if(t){const{PI:n,floor:o,min:s,max:a,sin:i,cos:l}=Math,c=n/2,u=2*n,h=Math.abs(t),d=e[0]/h,f=e[2]/h,p=o((d+c)/u)!==o((f+c)/u)?-h:s(i(d)*h,i(f)*h),g=o((d-c)/u)!==o((f-c)/u)?h:a(i(d)*h,i(f)*h),m=o((d+n)/u)!==o((f+n)/u)?2*h:a(h-l(d)*h,h-l(f)*h);r.min.set(p,e[1],t<0?-m:0),r.max.set(g,e[3],t<0?0:m)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(Kr).count,r=this._chunkedBounds;if(r)for(let n=r.length;n--;){t=r[n].end;let o=r[n].rect;if(o[1]<e.w&&o[3]>e.y&&o[0]<e.z&&o[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,r){const n=this.getAttribute(e);t?n&&n.array.length===t.length?(n.array.set(t),n.needsUpdate=!0):(this.setAttribute(e,new x(t,r)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}}const Qr=new N({color:16777215,side:B,transparent:!0}),Zr=8421504,Jr=new g,en=new m,tn=new m,rn=[],nn=new m,on="+x+y";function sn(e){return Array.isArray(e)?e[0]:e}let an=()=>{const e=new W(new Re(1,1),Qr);return an=()=>e,e},ln=()=>{const e=new W(new Re(1,1,32,1),Qr);return ln=()=>e,e};const cn={type:"syncstart"},un={type:"synccomplete"},hn=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],dn=hn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class fn extends W{constructor(){super(new Yr,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Zr,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=on,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(cn),Hr({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(e=>e&&e())})),this.dispatchEvent(un),e&&e()})))}onBeforeRender(e,t,r,n,o,s){this.sync(),o.isTroikaTextMaterial&&this._prepareForRender(o)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return function(e){const t=vr(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new l},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new _e(0,0,0,0)},uTroikaClipRect:{value:new _e(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new l},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new c},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Ae},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(cr,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Qr.clone());if(e&&e.isDerivedFrom(t)||(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),this.hasOutline()){let t=e._outlineMtl;return t||(t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),t.isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),t.dispose()})),[t,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return sn(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return sn(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,r=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:e,blockBounds:o}=n;r.uTroikaSDFTexture.value=e,r.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),r.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,r.uTroikaSDFExponent.value=n.sdfExponent,r.uTroikaTotalBounds.value.fromArray(o),r.uTroikaUseGlyphColors.value=!t&&!!n.glyphColors;let s,a,i,l=0,c=0,u=0,h=0,d=0;if(t){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:r,outlineBlur:n,outlineOpacity:o}=this;l=this._parsePercent(e)||0,c=Math.max(0,this._parsePercent(n)||0),s=o,h=this._parsePercent(t)||0,d=this._parsePercent(r)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(i=this.strokeColor,r.uTroikaStrokeColor.value.set(null==i?Zr:i),a=this.strokeOpacity,null==a&&(a=1)),s=this.fillOpacity;r.uTroikaEdgeOffset.value=l,r.uTroikaPositionOffset.value.set(h,d),r.uTroikaBlurRadius.value=c,r.uTroikaStrokeWidth.value=u,r.uTroikaStrokeOpacity.value=a,r.uTroikaFillOpacity.value=null==s?1:s,r.uTroikaCurveRadius.value=this.curveRadius||0;let f=this.clipRect;if(f&&Array.isArray(f)&&4===f.length)r.uTroikaClipRect.value.fromArray(f);else{const e=100*(this.fontSize||.1);r.uTroikaClipRect.value.set(o[0]-e,o[1]-e,o[2]+e,o[3]+e)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const o=t?this.outlineColor||0:this.color;if(null==o)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new c;o===t._input&&"object"!=typeof o||t.set(t._input=o)}let s=this.orientation||on;if(s!==e._orientation){let t=r.uTroikaOrient.value;s=s.replace(/[^-+xyz]/g,"");let n=s!==on&&s.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,e,r,o,s]=n;en.set(0,0,0)[r]="-"===e?1:-1,tn.set(0,0,0)[s]="-"===o?-1:1,Jr.lookAt(nn,en.cross(tn),tn),t.setFromMatrix4(Jr)}else t.identity();e._orientation=s}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new l){t.copy(e);const r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new l){return en.copy(e),this.localPositionToTextCoords(this.worldToLocal(en),t)}raycast(e,t){const{textRenderInfo:r,curveRadius:n}=this;if(r){const o=r.blockBounds,s=n?ln():an(),a=s.geometry,{position:i,uv:l}=a.attributes;for(let e=0;e<l.count;e++){let t=o[0]+l.getX(e)*(o[2]-o[0]);const r=o[1]+l.getY(e)*(o[3]-o[1]);let s=0;n&&(s=n-Math.cos(t/n)*n,t=Math.sin(t/n)*n),i.setXYZ(e,t,r,s)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,s.matrixWorld=this.matrixWorld,s.material.side=this.material.side,rn.length=0,s.raycast(e,rn);for(let e=0;e<rn.length;e++)rn[e].object=this,t.push(rn[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,dn.forEach(t=>{this[t]=e[t]}),this}clone(){return(new this.constructor).copy(this)}}function pn(e){return[["thin","normal","Thin"],["thin","italic","ThinItalic"],["extralight","normal","ExtraLight"],["extralight","italic","ExtraLightItalic"],["light","normal","Light"],["light","italic","LightItalic"],["regular","normal","Regular"],["regular","italic","Italic"],["medium","normal","Medium"],["medium","italic","MediumItalic"],["semibold","normal","SemiBold"],["semibold","italic","SemiBoldItalic"],["bold","normal","Bold"],["bold","italic","BoldItalic"],["extrabold","normal","ExtraBold"],["extrabold","italic","ExtraBoldItalic"],["black","normal","Black"],["black","italic","BlackItalic"]].map(([t,r,n])=>({weight:t,style:r,path:new URL(`${n}.ttf`,e).href}))}hn.forEach(e=>{const t="_private_"+e;Object.defineProperty(fn.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}),new he,new c;const gn={"space-grotesk":[{weight:"regular",style:"normal",path:new URL("../../docs/dist/assets/fonts/Space_Grotesk/static/SpaceGrotesk-Regular.ttf",import.meta.url).href},{weight:"light",style:"normal",path:new URL("../../docs/dist/assets/fonts/Space_Grotesk/static/SpaceGrotesk-Light.ttf",import.meta.url).href},{weight:"bold",style:"normal",path:new URL("../../docs/dist/assets/fonts/Space_Grotesk/static/SpaceGrotesk-Bold.ttf",import.meta.url).href},{weight:"medium",style:"normal",path:new URL("../../docs/dist/assets/fonts/Space_Grotesk/static/SpaceGrotesk-Medium.ttf",import.meta.url).href},{weight:"semibold",style:"normal",path:new URL("../../docs/dist/assets/fonts/Space_Grotesk/static/SpaceGrotesk-SemiBold.ttf",import.meta.url).href}],"inter-18pt":pn(new URL("../../docs/dist/assets/fonts/Inter/static/Inter_18pt-",import.meta.url)),"inter-24pt":pn(new URL("../../docs/dist/assets/fonts/Inter/static/Inter_24pt-",import.meta.url)),"inter-28pt":pn(new URL("../../docs/dist/assets/fonts/Inter/static/Inter_28pt-",import.meta.url)),roboto:[{weight:"regular",style:"normal",path:new URL("../../docs/dist/assets/fonts/Roboto/static/Roboto-Regular.ttf",import.meta.url).href},{weight:"bold",style:"normal",path:new URL("../../docs/dist/assets/fonts/Roboto/static/Roboto-Bold.ttf",import.meta.url).href},{weight:"light",style:"italic",path:new URL("../../docs/dist/assets/fonts/Roboto/static/Roboto-LightItalic.ttf",import.meta.url).href}],"roboto-condensed":[{weight:"regular",style:"normal",path:new URL("../../docs/dist/assets/fonts/Roboto/static/Roboto_Condensed-Regular.ttf",import.meta.url).href},{weight:"bold",style:"italic",path:new URL("../../docs/dist/assets/fonts/Roboto/static/Roboto_Condensed-BoldItalic.ttf",import.meta.url).href}],"roboto-semicondensed":[{weight:"regular",style:"normal",path:new URL("../../docs/dist/assets/fonts/Roboto/static/Roboto_SemiCondensed-Regular.ttf",import.meta.url).href}]};class mn{content;constructor(){this.content=new fn}set({text:t,options:{maxWidth:r=1,color:n=new e.Color(16777215),fontFamily:o="space-grotesk",fontWeight:s="regular",fontStyle:a="normal",fontSize:i=.015,anchorX:l="center",anchorY:c="top",whiteSpace:u="normal",overflowWrap:h="break-word",direction:d="ltr",textAlign:f="left",lang:p="en"}}){return this.content.text=t,this.content.fontSize=i,this.content.fontStyle=a,this.content.textAlign=f,this.content.overflowWrap=h,this.content.whiteSpace=u,this.content.anchorX=l,this.content.anchorY=c,this.content.direction=d,this.content.lang=p,this.content.maxWidth=.9*r,this.content.color=n,this.content.font=this._resolveFontPath(o,s,a),this.content.sync(),this.content}change({text:e}){this.content.text=e,this.content.sync()}_resolveFontPath(e,t,r){const n=gn[e];if(console.log(n),!n||0===n.length)return console.warn(`[TextHelper] Font family '${e}' not found in registry.`),"";const o=n.find(e=>e.weight===t&&e.style===r);return o||console.warn(`[TextHelper] Variant for '${e}' with weight='${t}' and style='${r}' not found. Using fallback.`),o?.path??n[0].path}}const vn={width:.1/1.1,height:.04/1.1,backgroundColor:3355443,textColor:16777215,fontSize:void 0};class yn extends e.Mesh{label;constructor({text:t="Button",options:r={}}){const n={...vn,...r};super(new e.PlaneGeometry(n.width,n.height),new e.MeshBasicMaterial({color:n.backgroundColor,transparent:!0})),this.label=(new mn).set({text:t,options:{maxWidth:n.width,fontSize:null!=n.fontSize?n.fontSize:.015,color:new e.Color(n.textColor),anchorX:"center",anchorY:"middle"}}),this.add(this.label)}setText(e){this.label.text=e,this.label.sync()}setBackgroundColor(t){this.material instanceof e.MeshBasicMaterial&&this.material.color.set(t)}setTextColor(t){this.label.color=new e.Color(t),this.label.sync()}}const xn={Template:zt,PerformanceHelper:Wt,Register:Yt,TextHelper:mn,ButtonHelper:yn};export{yn as ButtonHelper,xn as L3,Wt as PerformanceHelper,Yt as Register,zt as Template,mn as TextHelper};
//# sourceMappingURL=index.js.map
